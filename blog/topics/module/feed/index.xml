<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:series="https://publishpress.com/"
	>

<channel>
	<title>Module Archive - Tricktresor</title>
	<atom:link href="/blog/topics/module/feed/" rel="self" type="application/rss+xml" />
	<link></link>
	<description>Tipps und Tricks zu SAP R/3</description>
	<lastBuildDate>Wed, 28 Feb 2024 15:21:13 +0000</lastBuildDate>
	<language>de-DE</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=6.4.3</generator>

<image>
	<url>/wp-content/uploads/2019/02/cropped-Tricktresor-favicon-2019-32x32.png</url>
	<title>Module Archive - Tricktresor</title>
	<link></link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Finden ‚îÄ nicht suchen</title>
		<link>/blog/finden-%e2%94%80-nicht-suchen/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Wed, 28 Feb 2024 15:21:13 +0000</pubDate>
				<category><![CDATA[Info/ Doku/ Demo]]></category>
		<category><![CDATA[Programmierung]]></category>
		<category><![CDATA[Cross Applications]]></category>
		<guid isPermaLink="false">/?p=1044885</guid>

					<description><![CDATA[<p>Ich denke, nach beinahe 30 Jahren Erfahrung mit SAP-Systemen kann ich mich als alten Fuchs bezeichnen und es gibt wenig im ABAP-Umfeld, das ich noch nicht kenne (RAP und CAP und UI5 und so&#8217;n neumodischen Kram mal au√üen vor gelassen&#8230; üôÇ ). Diesen Monat sind mir jedoch bereits zwei Dinge begegnet, dir mir wirklich absolut neu sind. Das erste ist die M√∂glichkeit, einen Doppelklick in der Code-Vervollst√§ndigung von TYPES machen zu k√∂nnen. Das zweite ist...</p>
<p>Der Beitrag <a href="/blog/finden-%e2%94%80-nicht-suchen/">Finden ‚îÄ nicht suchen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>Ich denke, nach beinahe 30 Jahren Erfahrung mit SAP-Systemen kann ich mich als alten Fuchs bezeichnen und es gibt wenig im ABAP-Umfeld, das ich noch nicht kenne (RAP und CAP und UI5 und so&#8217;n neumodischen Kram mal au√üen vor gelassen&#8230; <img src="https://s.w.org/images/core/emoji/14.0.0/72x72/1f642.png" alt="üôÇ" class="wp-smiley" style="height: 1em; max-height: 1em;" /> ). Diesen Monat sind mir jedoch bereits zwei Dinge begegnet, dir mir wirklich absolut neu sind. Das erste ist die M√∂glichkeit, einen <a href="https://www.linkedin.com/posts/enno-wulff_sapabap-sapdeveloper-sapabaponhana-activity-7166471749868453888-TEKv?utm_source=share&amp;utm_medium=member_desktop">Doppelklick in der Code-Vervollst√§ndigung von TYPES</a> machen zu k√∂nnen. Das zweite ist ein Programm, √ºber das ich heute gestolpert bin und das mir in Zukunft viel Sucharbeit ersparen wird: </p>



<p class="has-text-align-left has-pale-cyan-blue-background-color has-background has-medium-font-size"><strong>RDOCFINDER</strong> &#8211; Full Text Search for Short and Long Texts</p>



<p>Bilder sagen mehr, als tausend Worte. Also bittesch√∂n:</p>



<h2 class="wp-block-heading">Selektionsbild</h2>



<figure class="wp-block-image size-large"><img fetchpriority="high" decoding="async" width="1024" height="558" src="/wp-content/uploads/2024/02/image-1-1024x558.png" alt="" class="wp-image-1044886" srcset="/wp-content/uploads/2024/02/image-1-1024x558.png 1024w, /wp-content/uploads/2024/02/image-1-300x163.png 300w, /wp-content/uploads/2024/02/image-1-768x418.png 768w, /wp-content/uploads/2024/02/image-1-1536x836.png 1536w, /wp-content/uploads/2024/02/image-1-71x40.png 71w, /wp-content/uploads/2024/02/image-1.png 1552w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<h2 class="wp-block-heading">Ergebnisliste</h2>



<figure class="wp-block-image size-large"><img decoding="async" width="1024" height="539" src="/wp-content/uploads/2024/02/image-2-1024x539.png" alt="" class="wp-image-1044887" srcset="/wp-content/uploads/2024/02/image-2-1024x539.png 1024w, /wp-content/uploads/2024/02/image-2-300x158.png 300w, /wp-content/uploads/2024/02/image-2-768x404.png 768w, /wp-content/uploads/2024/02/image-2-1536x809.png 1536w, /wp-content/uploads/2024/02/image-2.png 1538w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<h2 class="wp-block-heading">Unterst√ºtzte Objekte</h2>



<pre class="wp-block-preformatted">Suche nach Terminologie-Begriffen in folgenden Objekten:<br>- DDIC-Objekte     "Datenelemente (F1)                  DE   +<br>                   "Datenelementzus√§tze (F1)            DZ   +<br>                   "Schl√ºsselw√∂rter der Datenelemente   DS   +<br>                   "Kurztext der Datenelemente          DK   +<br>                   "Report√ºberschrift Datenelement      DR   +<br>                   "Dom√§nen (F1)                        DO   +<br>                   "Kurztext der Dom√§nen                DK   +<br>                   "Dom√§nen-Festwerte (F1)              DV   +<br>                   "Tabellen/Strukturen (F1)            TB   +<br>                   "Kurztext der Tabellen               TK   +<br>                   "Feld/Komponente der Tabellen        TF   +<br>                   "Indizes der Tabellen                TX   +<br>                   "Kurztext der Tabellentypen          TT   +<br>                   "Kurztext der Views                  TV   +<br>                   "Kurztext der Suchhilfen             SH   +<br>                   "Kurztext der Sperrobjekte           EQ   +<br>- Benutzerstamm    "Benutzerstamm Objekte (F1)          UO   +<br>                   "Kurztext der Objekte                OK   +<br>                   "Benutzerstamm Profile (F1)          UP   +<br>                   "Kurztext der Profile                PK   +<br>- Nachrichten      "Nachrichten (F1)                    NA   +<br>                   "Kurztext der Nachrichten            NK   +<br>                   "Kurztext der Nachrichtenklassen     NN   +<br>                   "Syslog-Meldungen (F1)               SL   +<br>                   "Kurztext der Syslog-Meldung         SK   +<br>- Reports          "Reports (F1)                        RE   +<br>                   "numerierte Texte usw.               R... +<br>                   "Dynpro-Texte                        DY   +<br>                   "Dynpro-Titel                        DX   +<br>- Klassenbibliotheken                                   CL/IF<br>                   "Klassen - Kurztext                  KT   +<br>                   "Klassen - Langtext                  CL   +<br>                   "Klassen Attribute - Kurztext        KT   +<br>                   "Klassen Attribute - Langtext        CA   +<br>                   "Klassen Methoden - Kurztext         KT   +<br>                   "Klassen Methoden - Langtext         CO   +<br>                   "Klassen Ereignisse - Kurztext       KT   +<br>                   "Klassen Ereignisse - Langtext       CE   +<br>                   "Klassen Typen - Kurztext            KT   +<br>                   "Klassen Typen - Langtext            CT   +<br>                   "Interface - Kurztext                KT   +<br>                   "Interface - Langtext                IF   +<br>                   "Interface Attribute - Kurztext      KT   +<br>                   "Interface Attribute - Langtext      IA   +<br>                   "Interface Methoden - Kurztext       KT   +<br>                   "Interface Methoden - Langtext       IO   +<br>                   "Interface Ereignisse - Langtext     IE   +<br>                   "Interface Typen - Kurztext          KT   +<br>                   "Meth. Parameter/Ausnahmen- Kurztext SC   +<br>- Oberfl√§che       "Oberfl√§che (F1)                     CF<br>                   "Titel                               TI   +<br>                   "Funktionstastentext                 FM   +<br>                   "Ikonentext                          FI   +<br>                   "Quickinfo Ikone                     FQ   +<br>                   "Men√ºleiste                          MA   +<br>                   "Drucktastenbelegung                 MB   +<br>                   "GUI-Status                          MC   +<br>                   "Funktionstext                       MM   +<br>                   "Funktionstastenbelegung             MP   +<br>- Modellierungsobjekte                                  IM<br>                   "Entit√§tstypen - Kurztext            ET   +<br>                   "Entit√§tstypen - Langtext            UE   +<br>                   "Entit√§tstypen - Aliasname           EA   +<br>                   "Datenmodelle - Kurztext             DM   +<br>                   "Datenmodelle - Langtext             UD   +<br>                   "Beziehung - Kurztext                ER   +<br>                   "Beziehung - Langtext          UH/UR/UK   +<br>                   "Spezialisierungsart - Kurztext      ES   +<br>                   "Spezialisierungsart - Langtext      US   +<br>                   "Entit√§tstyp Kommentare - Langtext   UC   +<br>                   "Entit√§tstyp Beispiel - Langtext     UB   +<br>- IMG<br>                   "IMG-Struktur                        I    +<br>                   "IMG-Aktivit√§t                       I0   +<br>                   "IMG-Pflegeobjekt                    I1   +<br>                   "IMG-Attribute                       I2   +<br>                   "IMG-Doku                            IG   +<br>- Test-Objekte<br>                   "CATT-Testfall - Kurztext            GK   +<br>                   "CATT-Testfall - Langtext            GT   +<br>                   "eCATT-Testskript - Titel            E0   +<br>                   "eCATT-Testskript - Par./Kommandosch.E5   +<br>                   "eCATT-Testskript - Langtext         E    +<br>                   "eCATT-Testkonfig. - Titel           E1   +<br>                   "eCATT-Testkonfig. - Variante        E6   +<br>                   "eCATT-Testkonfig. - Langtext        E    +<br>                   "eCATT-Testdaten - Titel             E2   +<br>                   "eCATT-Testdaten - Param./Variante   E7   +<br>                   "eCATT-Testdaten - Langtext          E    +<br>                   "eCATT-Systemdaten - Titel           E3   +<br>                   "eCATT-Systemdaten - Zielsystem      E8   +<br>                   "eCATT-Systemdaten - Langtext        E    +<br>                   "eCATT-Validierungsobjekt - Titel    E4   +<br>                   "eCATT-Validierungsobjekt - Langtext E    +<br>- Erweiterungen<br>                   "SAP-Erweiterung (Modifik.) - Kurzt. MK   +<br>                   "SAP-Erweiterung (Modifik.) - Langt. MO   +<br>                   "Klassisches BAdI                    BA   +<br>                   "Implementierung Klassisches BAdI    BI   +<br>                   "Zusammengesetzter Erweiterungsspot  BJ   +<br>                   "Impl. Zusammenges. Erweiterungsspot BK   +<br>                   "Erweiterungsspot                    BS   +<br>                   "Erweiterungsspot - BAdI             B0   +<br>                   "Erweiterungsspot - BAdI TechDoku    B1   +<br>                   "Erweiterungsspot - BAdI - Filter    B2   +<br>                   "Erweiterungsspot - BAdI - Men√º-Erw. B3   +<br>                   "Erweiterungsspot - BAdI - Scr.-Erw. B4   +<br>                   "Impl. Erweiterungsspot              BT   +<br>                   "Impl. Erweiterungsspot - BAdI       B5   +<br>                   "Impl. Erweiterungsspot - BAdI TechD.B6   +<br>- allg. Text (TX)                                       TX   +<br>- Migrationstext (nur Langtext)                         MG   +<br>- Release-Infos (IN RELN) (nur Langtext)                IN   +<br>- SAPscript-Formulare (Langtext + Kurztext)             SF   +-<br>- SAPscript-Stile     (Kurztext)                        SS    -<br>- Funktionsbaustein-Doku (FU)                           FU   +<br>- Funktionsbaustein-Ausnahme-Doku (FX)                  FX   +<br>- Funktionsbaustein-Parameter/Ausnahme-Kurztext         FP   +<br>- Dialogbaustein-Doku<br>                   "Kurztext der Dialogbausteine        DB   +<br>                   "Langtext Dialogbaustein             DI   +<br>- Syntax-Doku (SD)<br>                   "ABAP                                S0   +<br>                   "Umgebung ABAP                       S1   +<br>                   "CONT                                S2   +<br>                   "Dynpro                              S3   +<br>                   "Editor                              S4   +<br>                   "RSYN                                S5   +<br>- Texte im Dialog (DT)                                  DT   +<br>- Kurzdump                                              KD   +<br>- SET/GET-Parameter                                     SG   +<br>- Bereichsmen√ºs                                         AM   +<br>- verschiedene Kurztexte<br>                   "Kurztext der Transaktionen          TA   +<br>                   "Kurztext der log. Datenbank         LD   +<br>- Gateway texts<br>                   "Data Object Hierarchy  - long text  GH<br>                   "Data Object Hierarchy  - short text GJ<br>                   "Data Object            - long text  GD<br>                   "Data Object            - short text GE<br>                   "Operation              - long text  GO<br>                   "Operation              - short text GP<br>                   "Consumption Model      - long text  GS<br>                   "Consumption Model      - short text GU</pre>
<p>Der Beitrag <a href="/blog/finden-%e2%94%80-nicht-suchen/">Finden ‚îÄ nicht suchen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>Auftragserfassung: Automatische (Positions-) Texte</title>
		<link>/blog/auftragserfassung-automatische-positions-texte/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Tue, 17 May 2022 11:45:55 +0000</pubDate>
				<category><![CDATA[Info/ Doku/ Demo]]></category>
		<category><![CDATA[Vertrieb]]></category>
		<category><![CDATA[ITF]]></category>
		<category><![CDATA[SAVE_TEXT]]></category>
		<category><![CDATA[READ_TEXT]]></category>
		<category><![CDATA[INIT_TEXT]]></category>
		<category><![CDATA[COMMIT_TEXT]]></category>
		<category><![CDATA[Langtext]]></category>
		<guid isPermaLink="false">/?p=1035891</guid>

					<description><![CDATA[<p>√úber Langtexte im SAP wird oft geschimpft, da sie aus historischen Gr√ºnden umst√§ndlicher verwaltet werden, als man es aktuell tun w√ºrde. Dieser Artikel soll eine kurze √úbersicht √ºber Texte im Allgemeinen und die Verwendung von Langtexten im SAPMV45A-Umfeld.</p>
<p>Der Beitrag <a href="/blog/auftragserfassung-automatische-positions-texte/">Auftragserfassung: Automatische (Positions-) Texte</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>In der Auftragserfassung (Modulpool SAPMV45A) sollen bei Auftragsanlage oder -√§nderung kundenindividuelle Texte definiert werden. </p>



<h2 class="wp-block-heading">Standard-Textfindung</h2>



<p>Im Standard l√§sst sich bereits eine umfangreiche Textfindung einstellen. Hier geht es jedoch darum, Texte aus anderen Objekten (Vorg√§ngerbelegen, Kunden, Materialien, &#8230;) zu finden und zu √ºbernehmen.</p>



<p>Ausgangspunkt ist die Transaktion VOFM, Men√º <em>Kopierbedingungen ‚Ä¢ Texte</em> oder <em>Daten√ºbernahme ‚Ä¢ Texte</em>. Hier kannst du Bedingungen programmieren und zuordnen, die den gew√ºnschten Text ermitteln.</p>



<h2 class="wp-block-heading">Textverwaltung in SAP</h2>



<p>In diesem Artikel geht es darum, individuelle Texte in eine Auftragsposition zu bekommen. Um das zu realisieren, muss man wissen, wie die Textverwaltung im SAP funktioniert. Darum hier ein kurzer Abriss zu den SAP-Langtexten.</p>



<p>Standardlangtexte k√∂nnen in der Transaktion SO10 erstellt und bearbeitet werden. Zur Bearbeitung hast die Auswahl zwischen dem uralten Zeilen-Editor und dem PC-Editor, der zwischenzeitlich durch Microsoft Word abgel√∂st wurde.</p>



<h3 class="wp-block-heading">Absatzformate</h3>



<p>Ein SAP-Langtext oder auch SAP-Script- oder ITF-Text, besteht aus einem Absatzformat und einer Zeile. Absatzformate k√∂nnen in <em>Stilen </em>definiert und zugeordnet werden (Transaktion SE72).</p>



<p>Das Sternchen * ist das Standardabsatzformat. Steht das * in der Spalte Absatzformat, dann erfolgt auf jeden Fall ein Zeilenumbruch. Bei einem Flie√ütext ist das Absatzformat leer.</p>



<figure class="wp-block-image size-full"><img decoding="async" width="682" height="501" src="/wp-content/uploads/2022/05/image.png" alt="" class="wp-image-1035903" srcset="/wp-content/uploads/2022/05/image.png 682w, /wp-content/uploads/2022/05/image-300x220.png 300w" sizes="(max-width: 682px) 100vw, 682px" /><figcaption class="wp-element-caption">Alter Zeileneditor</figcaption></figure>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="908" height="650" src="/wp-content/uploads/2022/05/image-1.png" alt="" class="wp-image-1035904" srcset="/wp-content/uploads/2022/05/image-1.png 908w, /wp-content/uploads/2022/05/image-1-300x215.png 300w, /wp-content/uploads/2022/05/image-1-768x550.png 768w, /wp-content/uploads/2022/05/image-1-240x172.png 240w" sizes="(max-width: 908px) 100vw, 908px" /><figcaption class="wp-element-caption">Microsoft Word Editor</figcaption></figure>



<h3 class="wp-block-heading">Felder</h3>



<p>Um einen Text eindeutig zu identifizieren, sind die folgenden Felder notwendig:</p>



<figure class="wp-block-table"><table><thead><tr><th>Feldname</th><th>Beschreibung</th><th>Infos</th></tr></thead><tbody><tr><td>TDOBJECT</td><td>Textobjekt</td><td>Definiert den Anwendungsbereich. Standardtexte haben das Textobjekt TEXT, Auftragskopftexte VBBK und Auftragspositionstexte VBBP, Materialstamm hat MATERIAL und MVKE. Textobjekte werden mit Hilfe der Transaktion SE75 definiert. F√ºr eigene Anwendungen k√∂nnen im Kundennamensraum eigene Objekte definiert werden.</td></tr><tr><td>TDNAME</td><td>Textname</td><td>Der Textname besteht bei Texten zu Anwendungsobjekten (Auftr√§ge, Kunden, Materialien, etc.) aus den Schl√ºsselfeldern der zugeh√∂rigen Tabelle. Beispiel: Vertriebstext Material (MVKE): &lt;matnr&gt;&lt;vkorg&gt;&lt;vtweg&gt;</td></tr><tr><td>TDID</td><td>Text-ID</td><td>Die Id definiert Texte innerhalb eines Text-Objektes. Sie muss im Customizing definiert werden (Transaktion SE75).</td></tr><tr><td>TDSPRAS</td><td>Sprache</td><td>Sprache des Textes.</td></tr></tbody></table><figcaption class="wp-element-caption">Schl√ºsselfelder STXH</figcaption></figure>



<h3 class="wp-block-heading">Speicherort</h3>



<p>Die Texte werden in den Tabellen STXH (Kopfdaten) und STXL (Textzeilen) gespeichert. Die Tabelle STXH kann man in der Tabellenanzeige (Transaktion SE16n) einsehen. In der STXL werden die Textzeilen jedoch komprimiert gespeichert und k√∂nnen nicht angesehen werden.</p>



<h3 class="wp-block-heading">Texte lesen</h3>



<p>Um Texte einzulesen, solltest du den Funktionsbaustein READ_TEXT verwenden. Um Texte zu suchen, kannst du direkt die Tabelle STXH durchsuchen oder du verwendest den Funktionsbaustein SELECT_TEXT.</p>



<h3 class="wp-block-heading">Speichern von Texten</h3>



<p>Die Speicherung von Texten erfolgt mit Hilfe des Funktionsbausteins SAVE_TEXT. Diesem Baustein m√ºssen die Schl√ºsselfelder √ºbergeben werden. Wenn man wei√ü, dass der Text noch nicht existiert, dann sollte aus Performancegr√ºnden der Parameter <code>INSERT = X</code> gesetzt werden. M√∂chte man den Text in einer eigenen Anwendung sofort sichern, so kann der Parameter <code>SAVEMODE_DIRECT = X</code> gesetzt werden. Beim Speichern von mehreren Texten sollte der Funktionsbaustein COMMIT_TEXT verwendet werden.</p>



<p>Mit dem Funktionsbaustein INIT_TEXT k√∂nnen Texte angelegt werden. </p>



<p>Funktionsbaustein DELETE_TEXT l√∂scht vorhandene Texte.</p>



<h3 class="wp-block-heading">Zentrales Textmemory</h3>



<p>Die Textverwaltung hat ein zentrales Memory. Aus diesem Grund sollte immer mit den entsprechenden Funktionsbausteinen auf die Texte zugegriffen werden. Der READ_TEXT liest den Text aus dem Textmemory, sofern vorhanden.</p>



<h2 class="wp-block-heading">Textverwaltung SAPMV45A</h2>



<p>Kommen wir nun endlich zum Ausgangsthema zur√ºck: Programmatische Bearbeitung von Texten in der Auftragsbearbeitung (Modulpool SAPMV45A). Du solltest wegen des zentralen Textmemories zur Bearbeitung immer die oben beschriebenen Funktionsbausteine verwenden. So kannst du in der Transaktion den Baustein READ_TEXT verwenden, um zu pr√ºfen, ob bereits ein Auftragskopftext zu einer bestimmten ID oder zu einer Position schon ein Text angelegt wurde, auch wenn diese noch nicht auf der Datenbank gespeichert wurde.</p>



<p>Eine separate Speicherung ist nicht notwendig bzw. sogar verboten -, denn die Speicherung erfolgt zentral durch die Applikation. Wird die Transaktion abgebrochen, dann werden die Texte auch nicht gespeichert.</p>



<p><strong>Auf keinen Fall darfst du im Baustein SAVE_TEXT den Parameter SAVEMODE_DIRECT setzen, den Baustein COMMIT_TEXT oder COMMIT WORK verwenden! Das wird von der Applikation SAPMV45A beim Sichern gemacht!</strong></p>



<p>Verwendest du doch einen COMMIT in den Exits, dann riskierst du einen Datenschiefstand und Fehlfunktionen von BAPIs.</p>



<h3 class="wp-block-heading">Codebeispiel</h3>



<p>In folgendem Code-Beispiel wird der Text zu einem neu eingegebenen Material aus dem Literal &#8220;ARKTX:&#8221; und dem aktuellen Artikeltext erstellt.</p>



<p></p>



<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">FORM userexit_move_field_to_vbap.
  DATA ls_header     TYPE thead.
  DATA lt_lines      TYPE STANDARD TABLE OF tline.

  IF vbap-vbeln IS INITIAL.
    ls_header-tdname   = 'XXXXXXXXXX' &amp;&amp; vbap-posnr.
  ELSE.
    ls_header-tdname   = vbap-vbeln &amp;&amp; vbap-posnr.
  ENDIF.
  ls_header-tdobject = 'VBBP'.
  ls_header-tdid     = '0001'.
  ls_header-tdspras  = sy-langu.
  CALL FUNCTION 'READ_TEXT'
    EXPORTING
      id        = ls_header-tdid
      language  = ls_header-tdspras
      name      = ls_header-tdname
      object    = ls_header-tdobject
      local_cat = space
    IMPORTING
      header    = ls_header
    TABLES
      lines     = lt_lines
    EXCEPTIONS
      OTHERS    = 8.
  IF sy-subrc &lt;> 0.
    lt_lines = VALUE #( ( tdformat = '*' tdline = |test { vbap-arktx }| ) ).
    CALL FUNCTION 'SAVE_TEXT'
      EXPORTING
        header          = ls_header
        insert          = abap_true
        savemode_direct = space
        local_cat       = space
      TABLES
        lines           = lt_lines
      EXCEPTIONS
        OTHERS          = 5.
  ENDIF.

ENDFORM.</pre>
<p>Der Beitrag <a href="/blog/auftragserfassung-automatische-positions-texte/">Auftragserfassung: Automatische (Positions-) Texte</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>L√∂schauftrag erstellen</title>
		<link>/blog/loeschauftrag-erstellen/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Thu, 18 Mar 2021 11:21:22 +0000</pubDate>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[Allgemein]]></category>
		<category><![CDATA[Cross Applications]]></category>
		<category><![CDATA[l√∂schen]]></category>
		<category><![CDATA[L√∂schauftrag]]></category>
		<category><![CDATA[Transportauftrag]]></category>
		<guid isPermaLink="false">/?p=1026567</guid>

					<description><![CDATA[<p>Das Anlegen von Objekten geh√∂rt zum Alltag eines SAP-Entwicklers. Auch das L√∂schen von Objekten geh√∂rt dazu. Wenn man ein Objekt l√∂scht, wird es jedoch als ganz normales Objekt in einen ganz normalen Transportauftrag aufgenommen. Erst bei Freigabe des Transportauftrags pr√ºft das System, ob das Objekt vorhanden ist oder nicht. Ist es nicht vorhanden, dann wird in dem Transportauftrag das Objekt als &#8220;zu l√∂schen&#8221; markiert. Leider funktioniert es nicht, das L√∂schkennzeichen in der Tabelle E071, in...</p>
<p>Der Beitrag <a href="/blog/loeschauftrag-erstellen/">L√∂schauftrag erstellen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>Das Anlegen von Objekten geh√∂rt zum Alltag eines SAP-Entwicklers. Auch das L√∂schen von Objekten geh√∂rt dazu. Wenn man ein Objekt l√∂scht, wird es jedoch als ganz normales Objekt in einen ganz normalen Transportauftrag aufgenommen. Erst bei Freigabe des Transportauftrags pr√ºft das System, ob das Objekt vorhanden ist oder nicht. Ist es nicht vorhanden, dann wird in dem Transportauftrag das Objekt als &#8220;zu l√∂schen&#8221; markiert. </p>



<p>Leider funktioniert es nicht, das L√∂schkennzeichen in der Tabelle E071, in der die Transportobjekte eines Auftrags gespeichert werden, zu setzen. Um einen L√∂schauftrag zu erzeugen, ben√∂tigt man in der Regel ein anderes System, in dem die Objekte nicht vorhanden sind. In diesem System √ºbernimmt man die Objekte in einen Transportauftrag und gibt diesen frei. </p>



<p>Eine andere M√∂glichkeit, ist die Erzeugung eines &#8220;echten&#8221; L√∂schauftrags per Programm. Hierbei muss allerdings ein bisschen getrickst werden, weil das Verfahren von SAP offiziell nicht unterst√ºtzt wird.</p>



<h2 class="wp-block-heading">Vorgehen</h2>



<p>Folgendes Vorgehen ist notwendig, um einen L√∂schauftrag zu erstellen.</p>



<h3 class="wp-block-heading">Anlage¬†eines¬†Transport-Of-Copies¬†</h3>



<p>Ein L√∂schauftrag¬†kann¬†nicht¬†direkt¬†angelegt¬†werden. Deswegen Legst du einen Auftrag vom Typ <em>Transport von Kopien</em> an. Du kannst auch einen normalen Workbench-Auftrag anlegen, aber wenn die Objekte evtl. noch in einem Transportauftrag gesperrt sind, dann ist nur ein Transport-von-Kopien m√∂glich.</p>



<h3 class="wp-block-heading">√úbernahme¬†der¬†Objekte</h3>



<p>Die zu l√∂schenden Objekte √ºbernimmst du nun manuell oder durch die Funktion <em>Auftrag/ Aufgabe ‚óè Objektliste </em>‚óè <em>Objekte aufnehmen </em>im Transport Organizer.</p>



<h3 class="wp-block-heading">Update¬†E070¬†f√ºr¬†den¬†neuen¬†Auftrag</h3>



<p>In Tabelle E070 werden die Transportauftr√§ge gespeichert. In dieser Tabelle musst du, zum Beispiel mit Hilfe der Transaktion SE16n und der Funktion &amp;sap_edit, die¬†Funktion¬†&#8220;L = L√∂schauftrag&#8221; im Feld TRFUNCTION setzen.</p>



<p><strong><span style="text-decoration: underline;">Achtung!</span></strong> Der Auftrag taucht nun nicht mehr in der √úbersicht im Transport-Organizer auf!</p>



<h3 class="wp-block-heading">Freigabe¬†des¬†L√∂schauftrags¬†</h3>



<p>Da der L√∂schauftrag nicht mehr in der √úbersicht im Transport-Organizer auftaucht (Transaktion SE09), kannst du den Auftrag auch nicht¬†manuell¬†im¬†Dialog freigeben.</p>



<p>Um den Auftrag freizugeben, musst du den Function Builder (Transaktion SE37) aufrufen und den Funktionsbaustein TRINT_TP_INTERFACE ausf√ºhren.</p>



<p>F√ºlle die Parameter IV_TP_COMMAND mit &#8220;R3E&#8221;, IV_TRANSPORT_REQUEST mit der Nummer deines L√∂sch-Transportauftrags und IV_UMODES mit &#8220;1&#8221;. Dann <em>Ausf√ºhren </em>klicken und der Auftrag wird exportiert. Eventuell taucht der Auftrag nicht in der Transportqueue des Folgesystems auf. In dem Fall musst du den Auftrag in der Transaktion STMS manuell √ºber <em>Zus√§tze ‚óè Weitere Auftr√§ge ‚óè Anh√§ngen</em> in die Transportqueue stellen.</p>
<p>Der Beitrag <a href="/blog/loeschauftrag-erstellen/">L√∂schauftrag erstellen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>Buchungsbelege erstellen</title>
		<link>/blog/buchungsbelege-erstellen/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Thu, 28 Jun 2018 13:48:59 +0000</pubDate>
				<category><![CDATA[Info/ Doku/ Demo]]></category>
		<category><![CDATA[Programmierung]]></category>
		<category><![CDATA[Finanz- und Rechnungswesen]]></category>
		<category><![CDATA[Sachkonto]]></category>
		<category><![CDATA[Ergebnisobjekt]]></category>
		<category><![CDATA[FI-Beleg]]></category>
		<category><![CDATA[CO-Beleg]]></category>
		<category><![CDATA[Kreditor]]></category>
		<category><![CDATA[Debitor]]></category>
		<guid isPermaLink="false">https://tricktresor.com/?p=1018903</guid>

					<description><![CDATA[<p>Folgend ein Report, der exemplarisch zeigt, wie FI-Belege gebucht werden k√∂nnen. Es werden Die Bausteine BAPI_ACC_DOCUMENT_CHECK und BAPI_ACC_DOCUMENT_POST verwendet. Aktuell macht der Report gar nichts! Die Kopf- und Positionsdaten m√ºssen in LT_BKPF und LT_BSEG entsprechend eingef√ºgt werden. Wie genau das geht, erf√§hrst du in dieser ausf√ºhrlichen Doku: Dokumentation FI Buchungen mittels BAPI_ACC_DOCUMENT_POST Vorgaben Ich gehe davon aus, das die zu buchenden Daten in der Form Kopf/Position vorliegen. Sollte dies nicht der Fall sein, so sollten...</p>
<p>Der Beitrag <a href="/blog/buchungsbelege-erstellen/">Buchungsbelege erstellen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>Folgend ein Report, der exemplarisch zeigt, wie FI-Belege gebucht werden k√∂nnen. Es werden Die Bausteine BAPI_ACC_DOCUMENT_CHECK und BAPI_ACC_DOCUMENT_POST verwendet.</p>
<p>Aktuell macht der Report gar nichts!</p>
<p>Die Kopf- und Positionsdaten m√ºssen in LT_BKPF und LT_BSEG entsprechend eingef√ºgt werden. Wie genau das geht, erf√§hrst du in dieser ausf√ºhrlichen Doku:</p>
<h2>Dokumentation</h2>
<p><a href="https://tricktresor.com/wp-content/uploads/2018/06/FI-Buchungen-mittels-BAPI_ACC_DOCUMENT_POST.pdf">FI Buchungen mittels BAPI_ACC_DOCUMENT_POST</a></p>
<h2>Vorgaben</h2>
<p>Ich gehe davon aus, das die zu buchenden Daten in der Form Kopf/Position vorliegen. Sollte dies nicht der Fall sein, so sollten diese vorher so aufbereitet werden, da dies den Umgang beim Programmieren wesentlich vereinfacht.</p>
<p>Das folgende Beispiel behandelt exemplarisch eine kreditorische Buchung,<br />
l√§√üt sich jedoch prinzipiell ebenso auf debitorische oder Sachkonten-<br />
buchungen √ºbertragen.<br />
Als Schmankerl wird ein zus√§tzliches Feld, welches nicht in der Sachkontenzeile<br />
enthalten ist (LZBKZ &#8211; Landeszentralbankkennzeichen) mitgegeben und die Steuer<br />
mit einem Steuerschema gebucht, welches zwei Steuerzeilen enth√§lt.</p>
<p>Prinzipiell muss man folgendes Wissen zur Buchung von FI-Belegen wissen:</p>
<ol>
<li>Die erste Zeile des zu buchenden Beleges enth√§lt den Betrag IMMER als Brutto-Wert! Unabh√§ngig davon ob diese kreditorisch, debitorisch oder eine Sachkontenbuchung ist.</li>
<li>Bei kreditorischen oder debitorischen Buchungen tauchen diese als Zeile nur ein mal als erste Zeile auf!</li>
<li>Steuerkennzeichen M√úSSEN mitgeliefert werden sonst kann keine Steuer gebucht werden.</li>
</ol>
<h3>Kopfdaten</h3>
<p>Wenn die Daten aus einem R3-System kommen, liegen die Daten normalerweise in der Form BUKRS/BELNR/GJAHR + Datenteil (f√ºr BKPF/BSEG) vor.<br />
Sollte dies nicht der Fall, so erh√§lt man normalerweise, wie in diesem Beispiel, eine laufende, eindeutige Nummer als Identifikator.<br />
F√ºr den Kopf auf jeden Fall m√ºssen mitgegeben werden:</p>
<ul>
<li>BUDAT &#8211; Buchungsdatum</li>
<li>BLDAT &#8211; Belegdatum</li>
<li>BUKRS &#8211; Buchungskreis</li>
<li>BLART &#8211; Belegart</li>
<li>WAERS &#8211; W√§hrung in der gebucht werden soll (Belegw√§hrung)</li>
</ul>
<p>Bei Fremdw√§hrungsbuchungen m√ºssen zus√§tzlich das Feld</p>
<ul>
<li>KURSF &#8211; Umrechnungskurs zur Buchungskreisw√§hrung (Zeilentyp BAPIACCR09)<br />
<em><strong>ODER!!!!</strong></em></li>
<li>WWERT &#8211; Umrechnungsdatum (Zeilentyp BAPIACHE09)</li>
</ul>
<p>mitgegeben werden &#8211; keinesfalls beide!</p>
<p>Bei kreditorischen Buchungen ist z.B. auch die Referenz zu f√ºllen</p>
<ul>
<li>XBLNR &#8211; Referenznummer (Belegnummer des Lieferanten)</li>
</ul>
<p>All diese Werte m√ºssen bekannt sein und mitgegeben werden.</p>
<p>Das Buchungsdatum kann auch leer gelassen werden, dann wird aus dem Systemdatum die entsprechenden Werte f√ºr GJAHR und POPER errechnet (siehe Routine ADD_DATA_BKPF).<br />
Ansonsten wird das mitgegebene Buchungsdatum verwendet und zur Berechnung verwendet</p>
<ul>
<li>BKTXT &#8211; Kopftext (braucht man manchmal)</li>
</ul>
<h2>Positionsdaten</h2>
<ul>
<li>Als Mussdaten sind notwendig:</li>
<li>BUZEI fortlaufende Buchungszeilennummer.<br />
Kann man auch &#8220;on the fly&#8221; erzeugen einfacher ist es, wenn sie bereits gef√ºllt ist. Die Buchungszeile stellt √ºber den in jedem Segment vorhandenen Parameter ITEMNO_ACC die Verbindung bzw. die Sortierung der einzelnen Zeilen des Beleges untereinander sicher</li>
<li>KOART Kontoart<br />
K &#8211; Kreditorische Buchungszeile, D &#8211; Debitorische Buchungszeile,<br />
S &#8211; Sachkontenzeile</li>
<li>SHKZG Soll-/Haben Kennzeichen S/H<br />
Auch aus Fremdsystemen erh√§lt man normalerweise dieses Kennzeichen. Es dient dazu, das Vorzeichen f√ºr die Betr√§ge, welche dem BAPI √ºbergeben werden, richtig zu ermitteln. Dies setzt voraus, das die Betr√§ge (!!) immer als positive Werte √ºbergeben werden &#8211; was im R/3 immer der Fall ist und bei Fremdsystembelegen zu 99% (SAP hat schlie√ülich die Buchhaltung nicht erfunden <img src="https://s.w.org/images/core/emoji/14.0.0/72x72/1f609.png" alt="üòâ" class="wp-smiley" style="height: 1em; max-height: 1em;" /> )<br />
Habenwerte sind hierbei immmer mit -1 zu multiplizieren, Sollwerte behalten Ihr positives Vorzeichen</li>
<li>GKONT Gegenkonto<br />
Im Fall einer kreditorischen bzw. debitorischen Zeile die Lieferanten- bzw. Kundennummer. Im Fall einer Sachkontenzeile die Kontonummer, auf welche gebucht werden soll</li>
<li>MWSKZ Mehrwertsteuerkennzeichen<br />
MUSS, im Falle einer ggf. zu buchenden Steuer, mitgegeben werden. Hier√ºber werden die zu buchenden Steuerzeilen ermittelt</li>
<li>BRUTTO Bruttowert der Buchungszeile. Wird immer benutzt bei &#8220;Kopfzeilen&#8221; d.h. bei kreditorische, debitorischen oder der 1. Zeile eines Sachkontenbeleges</li>
<li>NETTO Nettowert der Buchungszeile d.h. ohne Steuer<br />
Wird bei allen &#8220;Positionszeilen&#8221;, d.h. ab Zeile 2 des Beleges benutzt</li>
</ul>
<h3>Kontierungen</h3>
<p>Im Beispiel habe ich Kontierungen auf Kostenstellen, Innenauftr√§ge, SD-Belege und Anlagen vorgesehen.</p>
<ul>
<li>SGTXT Positionstext (braucht man manchmal)</li>
<li>LANDL Lieferland<br />
Wird ben√∂tigt, wenn der Lieferant im Ausland ans√§ssig ist &#8211; kann man aber auch durch nachlesen des Landes aus der Adresse des Lieferanten holen. Hier der Einfachheit halber in der Struktur</li>
</ul>
<h4>Schmankerl 1</h4>
<ul>
<li>LZBKZ Landeszentralbankkennzeichen<br />
Die betrifft Rechnungen von ausl√§ndischen Lieferanten die eine Sonstige Leistung i.S. des Umsatzsteuergesetzes erbracht haben. Der ¬ß13b UStG regelt unter einzelnen Punkten in welchen F√§llen der Leistungsempf√§nger f√ºr die Leistungen die Umsatzsteuer schuldet.<br />
Gleichzeitig darf der Leistungsempf√§nger sich diesen Betrag als Vorsteuer in Abzug bringen.<br />
Steht in der BSEG als Feld zur Verf√ºgung, ist aber nicht in der kreditorischen Struktur BAPIACAP09 vorhanden!!! Mu√ü √ºber die Tabelle extension2 des BAPI&#8217;s √ºbergeben werden<br />
Ausf√ºhrungen dazu in der Unterroutine f√ºr die Kreditorenzeile</li>
</ul>
<h4>Schmankerl 2</h4>
<ul>
<li>CO-PA Kontierung<br />
Bei Kontierung auf CO-PA Objekte (Ergebnisobjekte) kommt es oft genug vor, das vom Kunden nur der Vertriebsbeleg vorgegeben wird und alles andere soll ermittelt werden. Wir befinden uns nicht in der FB01 oder FB60 und k√∂nnen auf den Knopf &#8220;Ableitung&#8221; dr√ºcken.<br />
Was also tun? Siehe hierzu die Unterroutine &#8220;ADD_COPA_LINE&#8217;.</li>
</ul>
<h2>Coding</h2>
<pre class="lang:abap decode:true">*&amp;---------------------------------------------------------------------*
*&amp; Report Z_POST_ACC_DOCUMENT
*&amp;---------------------------------------------------------------------*
*&amp;
*&amp;---------------------------------------------------------------------*
REPORT z_post_acc_document.

******** KOPFDATEN **************
TYPES: BEGIN OF gtys_bkpf,
         id    TYPE numc10,
         bukrs TYPE bkpf-bukrs,
         gjahr TYPE bkpf-gjahr,
         poper TYPE poper,
         blart TYPE bkpf-blart,
         bldat TYPE bkpf-bldat,
         budat TYPE bkpf-budat,
         xblnr TYPE bkpf-xblnr,
         bktxt TYPE bkpf-bktxt,
         waers TYPE bkpf-waers,
         kursf TYPE bkpf-kursf,
         wwert TYPE bkpf-wwert,
         belnr TYPE bkpf-belnr,
       END OF gtys_bkpf,
       gtyt_bkpf TYPE STANDARD TABLE OF gtys_bkpf.

******** POSITIONSDATEN ***********
* Schmankerl 1
* LZBKZ  Landeszentralbankkennzeichen
*        Die betrifft Rechnungen von ausl√§ndischen Lieferanten die eine Sonstige Leistung
*        i.S. des Umsatzsteuergesetzes erbracht haben. Der ¬ß13b UStG regelt unter einzelnen
*        Punkten in welchen F√§llen der Leistungsempf√§nger f√ºr die Leistungen die Umsatzsteuer schuldet.
*        Gleichzeitig darf der Leistungsempf√§nger sich diesen Betrag als Vorsteuer in Abzug bringen.
*        Steht in der BSEG als Feld zur Verf√ºgung, ist aber nicht in der kreditorischen
*        Struktur BAPIACAP09 vorhanden!!! Mu√ü √ºber die Tabelle extension2 des BAPI's √ºbergeben werden
*        Ausf√ºhrungen dazu in der Unterroutine f√ºr die Kreditorenzeile "ADD_CRED_LINE"
* Schmankerl 2
* VBELN   CO-PA Kontierung
*        Bei Kontierung auf CO-PA Objekte (Ergebnisobjekte) kommt es oft genug vor,
*        das vom Kunden nur der Vertriebsbeleg vorgegeben wird und alles andere soll
*        ermittelt werden. Wir befinden uns nicht in der FB01 oder FB60 und k√∂nnen auf
*        den Knopf "Ableitung" dr√ºcken.
*        Was also tun?
*        Siehe hierzu die Unterroutine "ADD_COPA_LINE'.
* Schmankerl 3
* BWASL  Bewegungsartenschl√ºssel
*        Bei der direkten Buchung von Kreditor auf Anlage mu√ü der Bewegungsartenschl√ºssel
*        vorgegeben werden. Dieser ist zwingend notwendig, sonst kommt keine Buchung zustande
*        bzw. wird abgelehnt.
*        N√§heres hierzu in der Unterroutine "ADD_SACH_LINE'.
TYPES: BEGIN OF gtys_bseg,
         id     TYPE numc10,
         buzei  TYPE bseg-buzei,
         koart  TYPE bseg-koart,
         shkzg  TYPE bseg-shkzg,
         gkont  TYPE gkont,
         brutto TYPE bseg-wrbtr,
         netto  TYPE bseg-wrbtr,
         mwskz  TYPE bseg-mwskz,
         sgtxt  TYPE bseg-sgtxt,
         kostl  TYPE bseg-kostl,
         aufnr  TYPE bseg-aufnr,
         vbeln  TYPE bseg-vbeln,
         posnr  TYPE bseg-posn2,
         anln1  TYPE bseg-anln1,
         anln2  TYPE bseg-anln2,
         lzbkz  TYPE bseg-lzbkz,
         landl  TYPE bseg-landl,
         bwasl  TYPE bwasl,
       END OF gtys_bseg,
       gtyt_bseg TYPE STANDARD TABLE OF gtys_bseg.

* Struktur f√ºr den Aufbau der Steuerzeilen
TYPES: BEGIN OF gtys_tax,
         mwskz TYPE mwskz,
         wmwst TYPE wmwst,
         msatz TYPE msatz_f05l,
         ktosl TYPE ktosl,
         kawrt TYPE kawrt,
         hkont TYPE hkont,
         kschl TYPE kschl,
       END OF gtys_tax,
       gtyt_tax TYPE STANDARD TABLE OF gtys_tax.

* Org-Daten f√ºr CO-PA Ermittlung
TYPES: BEGIN OF gtys_org_copa,
         bukrs TYPE bukrs,
         kokrs TYPE kokrs,
         erkrs TYPE erkrs,
       END OF gtys_org_copa,
       gtyt_org_copa_hash TYPE HASHED TABLE OF gtys_org_copa
                       WITH UNIQUE KEY bukrs.
* Neue CO-PA Ableitung
TYPES: gtyt_copadata TYPE copadata_tab.

* Testparameter
PARAMETERS: p_xtest TYPE xfeld DEFAULT 'X'.

START-OF-SELECTION.
  PERFORM processing.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  PROCESSING
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM processing .

  DATA: lt_bkpf  TYPE gtyt_bkpf.
  DATA: ls_bkpf  TYPE gtys_bkpf.
  DATA: lt_bseg  TYPE gtyt_bseg.
  DATA: ls_bseg  TYPE gtys_bseg.

* Die Datentabellen sind in diesem Beispiel nicht gef√ºllt
* Im beiliegenden PDF sind exemplarisch einige Buchungss√§tze zusammengestellt,
* welche aber nur f√ºr das System g√ºltig sind, in dem Sie verbucht wurden.
* Um das Beispiel nutzen zu k√∂nnen, m√º√üt ihr hier die Daten entsprechend
* Eurem System von Hand aufbauen
* Das Buchungsdatum habe ich leer gelassen, da in diesem Beispiel immer mit dem
* aktuellen Tagesdatum gebucht wird.
* Die Felder GJAHR und POPER werden w√§hrend des Programmlaufes ermittelt
* und dann in die LS_BKPF √ºbertragen - f√ºr den Fall, das man das ganze
* als Vorlage f√ºr eine Schnittstelle laufen lassen will ;-)
*
* F√ºr die Standardbuchung habe ich den Buchungssatz hier ausgesternt schon
* einmal vorbereitet:
*  CLEAR ls_bkpf.
*  ls_bkpf-id    = '1'.
*  ls_bkpf-budat = '00000000'.
*  ls_bkpf-bldat = '20180611'.
*  ls_bkpf-bukrs = '1000'.
*  ls_bkpf-gjahr = '0000'.
*  ls_bkpf-poper = '000'.
*  ls_bkpf-xblnr = '123'.
*  ls_bkpf-waers = 'EUR'.
*  APPEND ls_bkpf TO lt_bkpf.
*
*  CLEAR ls_bseg.
*  ls_bseg-id    = '1'.
*  ls_bseg-buzei = '001'
*  ls_bseg-koart = 'K'.
*  ls_bseg-shgkz = 'H'.
*  ls_bseg-gkont = '0000100205'.
*  ls_bseg-mwskz = abap_false.
*  ls_bseg-brutto = '1725.00'.
*  ls_bkpf-landl = 'DE'.
*  ls_bkpf-lzbkz = abap_false. "kein Nicht Deutscher Kreditor
*  APPEND ls_bseg TO lt_bseg.
*
*  CLEAR ls_bseg.
*  ls_bseg-id    = '1'.
*  ls_bseg-buzei = '002'.
*  ls_bseg-koart = 'S'.
*  ls_bseg-shgkz = 'S'.
*  ls_bseg-gkont = '0000479100'.
*  ls_bseg-mwskz = 'V3'.
*  ls_bseg-netto = '500.00'.
*  ls_bseg-kostl = '0000000100'.
*  ls_bseg-aufnr  = space.
*  ls_bseg-vbeln  = space.
*  ls_bseg-posnr  = '000000'.
*  ls_bseg-anln1  = space.
*  ls_bseg-anln2 = space.
*  ls_bseg-bwasl = space.
*  APPEND ls_besg TO lt_bseg.
*
*  CLEAR ls_bseg.
*  ls_bseg-id    = '1'.
*  ls_bseg-buzei = '003'.
*  ls_bseg-koart = 'S'.
*  ls_bseg-shgkz = 'S'.
*  ls_bseg-gkont = '0000479100'.
*  ls_bseg-mwskz = 'V2'.
*  ls_bseg-netto = '500.00'.
*  ls_bseg-kostl = '0000000100'.
*  ls_bseg-aufnr  = space.
*  ls_bseg-vbeln  = space.
*  ls_bseg-posnr  = '000000'.
*  ls_bseg-anln1  = space.
*  ls_bseg-anln2 = space.
*  ls_bseg-bwasl = space.
*  APPEND ls_besg TO lt_bseg.
*
*  CLEAR ls_bseg.
*  ls_bseg-id    = '1'.
*  ls_bseg-buzei = '004'.
*  ls_bseg-koart = 'S'.
*  ls_bseg-shgkz = 'S'.
*  ls_bseg-gkont = '0000479100'.
*  ls_bseg-mwskz = 'V3'.
*  ls_bseg-netto = '500.00'.
*  ls_bseg-kostl = '0000000140'.
*  ls_bseg-aufnr  = space.
*  ls_bseg-vbeln  = space.
*  ls_bseg-posnr  = '000000'.
*  ls_bseg-anln1  = space.
*  ls_bseg-anln2 = space.
*  ls_bseg-bwasl = space.
*  APPEND ls_besg TO lt_bseg.

  LOOP AT lt_bkpf INTO ls_bkpf.

    PERFORM post_acc_doc USING ls_bkpf
                               lt_bseg.
  ENDLOOP.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  POST_ACC_DOC
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM post_acc_doc USING pis_bkpf  TYPE gtys_bkpf
                        pit_bseg  TYPE gtyt_bseg.

  DATA: ls_bkpf   TYPE gtys_bkpf.
  DATA: lt_bseg   TYPE gtyt_bseg.
  DATA: ls_bseg   TYPE gtys_bseg.
  DATA: lt_tax    TYPE gtyt_tax.

  DATA: BEGIN OF ls_awkey,
          belnr TYPE bkpf-belnr,
          bukrs TYPE bkpf-bukrs,
          gjahr TYPE bkpf-gjahr,
        END OF ls_awkey.

  DATA: lv_buzei TYPE bseg-buzei.
  DATA: lv_tabix TYPE sy-tabix.
  DATA: lv_subrc TYPE sy-subrc.
  DATA: lv_exit  TYPE xfeld.

* BAPI-Definitionen
* BKPF
  DATA ls_header TYPE bapiache09.
* BAPI-Protokoll
  DATA lt_return TYPE bapiret2_tab.
  DATA ls_return TYPE bapiret2.
* Sachkontenzeile
  DATA lt_acc_gl TYPE bapiacgl09_tab.
* Kreditorenzeile
  DATA lt_acc_py TYPE bapiacap09_tab.
* Debitorenzeile - Im Beispiel nicht ausgef√ºhrt
  DATA lt_acc_rv TYPE bapiacar09_tab               ##NEEDED.
* Wertzeile
  DATA lt_cur_am TYPE bapiaccr09_tab.
* Steuerzeile
  DATA lt_acc_tx TYPE bapiactx09_tab.
* Zus√§tzliche Parameter (siehe Routine add_cred_line)
  DATA lt_ext2   TYPE tt_bapiparex.
* CO-PA Merkmalstabelle
  DATA lt_acc_crit  TYPE bapiackec9_tab.
* CO-PA Wertetabelle
  DATA lt_acc_value TYPE bapiackev9_tab.

  ls_bkpf = pis_bkpf.

* Kopfdaten aufbereiten
  PERFORM add_head_line CHANGING ls_bkpf
                                 ls_header.

* Loop √ºber alle Buchungszeilen des Beleges
  LOOP AT pit_bseg INTO ls_bseg
    WHERE id EQ ls_bkpf-id.
    lv_tabix = sy-tabix.
*   Kopieren der aktuellen Buchungszeile
*   Brauchen wir sp√§ter, wenn wir die Steuerzeilen erzeugen wollen
    lv_buzei = ls_bseg-buzei.

*   Unterscheidung nach Kontoart
    CASE ls_bseg-koart.
*     Debitorenzeile
      WHEN 'D'.
*       Behandeln wir hier nicht - ist aber analog zum Kreditoren

*     Kreditorenzeile
      WHEN 'K'.
*       Kreditorenzeile aufbauen
        PERFORM add_cred_line USING    pis_bkpf
                                       ls_bseg
                              CHANGING lt_acc_py
                                       lt_ext2.

*       Betragszeile
        PERFORM add_curr_line USING    pis_bkpf
                                       ls_bseg
                                       lv_tabix
                              CHANGING lt_cur_am.
      WHEN 'S'.
*       Sachkontenzeile
        PERFORM add_sach_line USING    ls_bkpf
                                       ls_bseg
                              CHANGING lt_acc_gl
                                       lt_acc_crit
                                       lt_acc_value
                                       lt_ext2
                                       lv_subrc.
        IF lv_subrc NE 0.
          lv_exit = abap_true.
          EXIT.
        ENDIF.

*       Betragszeile
        PERFORM add_curr_line USING    pis_bkpf
                                       ls_bseg
                                       lv_tabix
                              CHANGING lt_cur_am.

*       Steuer f√ºr Sachkontenpositionszeilen ermitteln
        PERFORM get_tax USING    pis_bkpf
                                 ls_bseg
                                 lv_tabix
                        CHANGING lt_tax.

    ENDCASE.
  ENDLOOP.

* Fehler bei der CO-PA Ermittlung - und raus
  IF lv_exit EQ abap_true.
    RETURN.
  ENDIF.

* Nachdem wir auf den Sachkontenzeilen alle Steuern
* gesammelt haben, bauen wir daraus jetzt die Steuerzeilen auf
  PERFORM add_tax_lines USING    lt_tax
                                 pis_bkpf
                                 lv_buzei
                        CHANGING lt_acc_tx
                                 lt_cur_am.

* Beleg pr√ºfen
  CALL FUNCTION 'BAPI_ACC_DOCUMENT_CHECK'
    EXPORTING
      documentheader = ls_header
    TABLES
      accountgl      = lt_acc_gl
      accountpayable = lt_acc_py
      accounttax     = lt_acc_tx
      currencyamount = lt_cur_am
      extension2     = lt_ext2
      return         = lt_return.
* Protokoll auswerten
  READ TABLE lt_return INTO ls_return
    WITH KEY type   = 'S'
             id     = 'RW'
             number = '614'.
  IF sy-subrc EQ 0.
*   Testflag abfragen
*   Wenn gesetzt, raus
    IF NOT p_xtest IS INITIAL.
      FORMAT COLOR COL_POSITIVE.
      WRITE:/ 'ID', pis_bkpf-id,
            'erfolgreich gebucht'                       ##NO_TEXT.
      FORMAT COLOR OFF.
      RETURN.
    ENDIF.
*   Kein Testflag. Buchen
    FREE lt_return.
    CALL FUNCTION 'BAPI_ACC_DOCUMENT_POST'
      EXPORTING
        documentheader = ls_header
      TABLES
        accountgl      = lt_acc_gl
        accountpayable = lt_acc_py
        accounttax     = lt_acc_tx
        currencyamount = lt_cur_am
        extension2     = lt_ext2
        return         = lt_return.
    READ TABLE lt_return INTO ls_return
      WITH KEY type   = 'S'
               id     = 'RW'
               number = '605'.
    IF sy-subrc EQ 0.
      MOVE ls_return-message_v2 TO ls_awkey.
*     Commit Work durchf√ºhren
      CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'
        IMPORTING
          return = ls_return.
      IF NOT ls_return IS INITIAL.
      ELSE.
        FORMAT COLOR COL_POSITIVE.
        WRITE:/ 'ID', pis_bkpf-id,
                'erfolgreich gebucht'                  ##NO_TEXT.
        FORMAT COLOR OFF.
        WRITE:/ 'Beleg'                                ##NO_TEXT,
                pis_bkpf-id,
                ls_awkey-bukrs,
                ls_awkey-belnr,
                ls_awkey-gjahr,
                'erfolgreich gebucht'                  ##NO_TEXT.
      ENDIF.
    ELSE.
      FORMAT COLOR COL_NEGATIVE.
      WRITE: /'ID', pis_bkpf-id, 'fehlerhaft'          ##NO_TEXT.
      FORMAT COLOR OFF.
      LOOP AT lt_return INTO ls_return
      WHERE type NE 'S'
      AND   type NE 'I'.
        IF ls_return-id     EQ 'RW' AND
           ls_return-number EQ '609'.
          CONTINUE.
        ENDIF.
        WRITE: / pis_bkpf-id,
                 ls_return-row,
                 ls_return-type,
                 ls_return-id,
                 ls_return-number,
                 ls_return-message.
      ENDLOOP.
    ENDIF.
* Fehler bei der Belegpr√ºfung
  ELSE.
    FORMAT COLOR COL_NEGATIVE.
    WRITE: /'ID', pis_bkpf-id, 'fehlerhaft'            ##NO_TEXT.
    FORMAT COLOR OFF.
    LOOP AT lt_return INTO ls_return
    WHERE type NE 'S'
    AND   type NE 'I'.
      IF ls_return-id EQ 'RW' AND
       ls_return-number EQ '609'.
        CONTINUE.
      ENDIF.
      WRITE:/ pis_bkpf-id,
              ls_return-row,
              ls_return-type,
              ls_return-id,
              ls_return-number,
              ls_return-message.
    ENDLOOP.
  ENDIF.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_HEAD_LINE
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM add_head_line  CHANGING pcs_bkpf   TYPE gtys_bkpf
                             pes_header TYPE bapiache09.

  CLEAR pes_header.

  DATA: ls_header TYPE bapiache09.

  ls_header-bus_act           = 'RFBU'.               "Betriebswirtschaftlicher Vorgang
  ls_header-username          = sy-uname.             "Name des Benutzers
  ls_header-header_txt        = pcs_bkpf-bktxt.       "Belegkopftext
  ls_header-comp_code         = pcs_bkpf-bukrs.       "Buchungskreis
  ls_header-doc_date          = pcs_bkpf-bldat.       "Belegdatum

* Ermitteln von Gesch√§ftsjahr und Periode aus dem Buchungsdatum
* In unserem Fall ist das Buchungsdatum leer, also nehmen wir das
* Tagesdatum. Es kann aber auch ein bestimmtes Datum √ºbergeben werden
* Dann aber darauf achten, das die entsprechenden Perioden zum
* Buchen offen sind
  PERFORM add_data_to_bkpf CHANGING pcs_bkpf.
  IF pcs_bkpf-budat IS INITIAL.
    ls_header-pstng_date      = sy-datum.             "Buchungsdatum
  ELSE.
    ls_header-pstng_date      = pcs_bkpf-budat.     "Buchungsdatum
  ENDIF.

  ls_header-trans_date        = sy-datum.             "Umrechnungsdatum
  ls_header-fisc_year         = pcs_bkpf-gjahr.       "Gesch√§ftsjahr
  ls_header-fis_period        = pcs_bkpf-poper.       "Gesch√§ftsmonat
  ls_header-doc_type          = pcs_bkpf-blart.       "Belegart
  ls_header-ref_doc_no        = pcs_bkpf-xblnr.       "Referenznummer

* Achtung !!!!
* Entweder Umrechnungsdatum oder Kurs - nicht beides mitgeben !!!!!
  IF NOT pcs_bkpf-wwert IS INITIAL.
    ls_header-trans_date    = pcs_bkpf-wwert.
  ENDIF.

* Sollten zus√§tzliche Werte ben√∂tigt werden, hier √ºbergeben
* oder die Kopftabelle entsprechend "aufbohren".

  pes_header = ls_header.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_DATA_TO_BKPF
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM add_data_to_bkpf CHANGING pcs_bkpf TYPE gtys_bkpf.

  TYPES: BEGIN OF ltys_t001,
           bukrs TYPE t001-bukrs,
           periv TYPE t001-periv,
         END OF ltys_t001,
         ltyt_t001 TYPE HASHED TABLE OF ltys_t001 WITH UNIQUE KEY bukrs.

  STATICS: lv_first_call TYPE xfeld.
  STATICS: lt_t001       TYPE ltyt_t001.
  DATA: ls_t001 TYPE ltys_t001.
  DATA: lv_buper TYPE poper.
  DATA: lv_gjahr TYPE gjahr.
  DATA: lv_budat TYPE bkpf-budat.

* Ermittlung der Gesch√§ftsjahresvariante f√ºr alle im System vorhandenen
* Buchungskreise
  IF lv_first_call IS INITIAL.
    SELECT bukrs periv
           FROM t001
           INTO TABLE lt_t001.
    MOVE abap_true TO lv_first_call.
  ENDIF.

  READ TABLE lt_t001 INTO ls_t001
    WITH TABLE KEY bukrs = pcs_bkpf-bukrs.
  IF sy-subrc EQ 0.
    IF pcs_bkpf-budat IS INITIAL.
      MOVE sy-datum       TO lv_budat.
    ELSE.
      MOVE pcs_bkpf-budat TO lv_budat.
    ENDIF.

*   Ermittlung der Periode und des Gesch√§ftsjahres
*   anhand des Buchungsdatum und der Gesch√§ftsjahresvariante
*   (Stichwort: Verschobenes Gesch√§ftsjahr)
    CALL FUNCTION 'DATE_TO_PERIOD_CONVERT'
      EXPORTING
        i_date         = lv_budat
        i_periv        = ls_t001-periv
      IMPORTING
        e_buper        = lv_buper
        e_gjahr        = lv_gjahr
      EXCEPTIONS
        input_false    = 1
        t009_notfound  = 2
        t009b_notfound = 3
        OTHERS         = 4.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE 'E' NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
    MOVE: lv_buper TO pcs_bkpf-poper,
          lv_gjahr TO pcs_bkpf-gjahr.
  ELSE.
*   Fehlermeldung - darf nicht vorkommen !!!!
*   Buchungskreis &amp;1 ist nicht vorhanden
    MESSAGE a215(fagl_emu) WITH pcs_bkpf-bukrs.
  ENDIF.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_CRED_LINE
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM add_cred_line  USING    pis_bkpf TYPE gtys_bkpf
                             pis_bseg TYPE gtys_bseg
                    CHANGING pct_cred TYPE bapiacap09_tab
                             pct_ext2 TYPE tt_bapiparex.

  DATA: ls_struc_ext2 TYPE zsc_s_soawf_badi_acc_doc.
  DATA: ls_cred  LIKE LINE OF pct_cred.
  DATA: ls_ext2  LIKE LINE OF pct_ext2.

* Kreditorenzeile
  ls_cred-itemno_acc        = pis_bseg-buzei.       "Positionsnummer des Rechnungswesenbeleges
  ls_cred-vendor_no         = pis_bseg-gkont.       "Lieferantennummer
* Das Sachkonto auf welches gebucht wird, ist immer das im Lieferantenstamm
* eingetragene Abstimmkonto
* Gilt √ºbrigens auch f√ºr Debitoren. Dort ist es AKONT in der KNB1
  SELECT SINGLE akont
                FROM lfb1
                INTO ls_cred-gl_account
                WHERE lifnr EQ pis_bseg-gkont
                AND   bukrs EQ pis_bkpf-bukrs.
  ls_cred-item_text         = pis_bseg-sgtxt.       "Positionstext
  ls_cred-supcountry        = pis_bseg-landl.       "Lieferland wenn nicht DE

* Schmankerl 1
* √úbergabe eines nicht in der Kreditorenstruktur vorhandenen Feldes - in diesem
* Falle das Landeszentralbankkennzeichen
  IF NOT pis_bseg-lzbkz IS INITIAL.
*   Hierzu MUSS!! man sich im DDIC eine Struktur definieren, welche
*   all die Felder enth√§lt, welche man zus√§tzlich √ºbergeben will.
*   Diese wird im Feld STRUCTURE der Struktur BAPIPAREX √ºbergeben.
*
*   Als Maximalmenge k√∂nnen die Felder der Struktur ACCIT √ºbergeben werden.
*   Die Struktur MUSS!!! immer ein Feld vom Typen
*   POSNR TYPE POSNR_ACC
*   enthalten. Dieser stellt die Verbindung von der √úbergabezeile (in diesem Falle
*   der Kreditorenzeile) zur Extension2-Zeile her.
*
*   Als weitere Felder werden dann die zu zus√§tzlich ben√∂tigten Felder √ºbergeben.
*
*   Um nun die Felder auch ins BAPI zu bringen, mu√ü man zum BADI ACC_DOCUMENT
*   mit der SE19 eine eigene Implementierung anlegen (oder, wenn Gl√ºck hat, ist
*   bereits eine vorhanden).
*   Hierzu MUSS!!! man den Filterwert auf BKPFF (nicht BKPF) stellen, da dieser
*   vom BAPI gefordert bzw. geschrieben wird.
*   Als Coding kann man das Coding der Beispielimplementierung der SAP nutzen, welche man
*   aus der Beispielimplementierung in die eigene Implementierung kopiert.
*   ACHTUNG!!!!!!
*   Nicht den Fehler machen und die ACCIT als Strukturnamen und √úbergabestruktur
*   benutzen. Die Felder VALUEPART1 bis VALUEPART4 werden concateniert und sind
*   insgesamt nur 960 Zeichen lang !!! Da kann man mit der ACCIT und Ihren 496 Feldern!
*   auch schon mal ganz schnell ins Klo greifen, wenn die Felder erst hinter
*   den 960 Zeichen aufgerufen werden.
*   Wenn man mehr als 240 Zeichen √úbergabe ben√∂tigt, ein Charakterfeld mit 960 Zeichen
*   definieren, die Struktur darauf moven, dann zerhaken und als VALUEPART1 bis 4 √ºbergeben.
*   ACHTUNG !!!!
*   Bei √úbergabe von Zahlfeldern diese vorher in Charakterwerte umwandeln und dann √ºbergeben,
*   sonst geht es schief. Ggf. die Implentierung entsprechend anpassen.
*   ACHTUNG !!!
*   Da die √úbergabefelder CHAR-Werte sind, kann Kleinschreibung nicht √ºbergeben werden.
*   Danke SAP!!!
    MOVE 'Z_BADI_ACC_DOC' TO ls_ext2-structure.
    ls_struc_ext2-posnr = pis_bseg-buzei.
    ls_struc_ext2-lzbkz = pis_bseg-lzbkz.
    MOVE ls_struc_ext2 TO ls_ext2-valuepart1.
    APPEND ls_ext2 TO pct_ext2.
  ENDIF.

  APPEND ls_cred TO pct_cred.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_CURR_LINE
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM add_curr_line  USING    pis_bkpf   TYPE gtys_bkpf
                             pis_bseg   TYPE gtys_bseg
                             piv_tabix  TYPE sy-tabix
                    CHANGING pet_curr   TYPE bapiaccr09_tab.

  DATA: ls_curr   LIKE LINE OF pet_curr.
  DATA: lv_amount TYPE bseg-wrbtr.

  CASE pis_bseg-koart.
*   Kreditorische/Debitorische Zeilen nur einmal im Beleg
*   als Kopfzeile - daher immer Brutto!!
    WHEN 'K' OR 'D'.
      MOVE pis_bseg-brutto TO lv_amount.
    WHEN 'S'.
*     Bei Sachkontenbuchungen Unterscheidung
*     nach Kopf- und Positionszeilen
      IF piv_tabix EQ 1.
        MOVE pis_bseg-brutto TO lv_amount.
      ELSE.
        MOVE pis_bseg-netto  TO lv_amount.
      ENDIF.
  ENDCASE.

* Habenwerte immer mit -1 multiplizieren (braucht das BAPI
* um zu erkennen, was es buchen soll)
  CASE pis_bseg-shkzg.
    WHEN 'H'.
      lv_amount = lv_amount * -1.
  ENDCASE.

  ls_curr-itemno_acc        = pis_bseg-buzei.
  ls_curr-currency          = pis_bkpf-waers.
* Wenn die W√§hrung nicht stimmen sollte, hier umwandeln
  ls_curr-currency_iso      = pis_bkpf-waers.
  ls_curr-amt_doccur        = lv_amount.
* W√§hrungstyp
* Hier steht die Belegw√§hrung, was der Standardfall ist.
* Sollen zus√§tzlich andere Typen verwendet werden, m√º√üen die Werte angepa√üt
* werden. Aber das ist ein ganz eigenes Kapitel. Werde ich ggf. bei
* Zeiten erg√§nzen.
  ls_curr-curr_type         = '00'.
* Umrechnungskurs f√ºr Fremdw√§hrung
* ACHTUNG!!!
* Entweder hier KURSF ODER!!!! im Kopf WWERT mitgeben
  ls_curr-exch_rate         = pis_bkpf-kursf.

  APPEND ls_curr TO pet_curr.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_SACH_LINE
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM add_sach_line  USING    pis_bkpf  TYPE gtys_bkpf
                             pis_bseg  TYPE gtys_bseg
                    CHANGING pct_sach  TYPE bapiacgl09_tab
                             pct_crit  TYPE bapiackec9_tab
                             pct_value TYPE bapiackev9_tab
                             pct_ext2  TYPE tt_bapiparex
                             pev_subrc TYPE sy-subrc.

  DATA: ls_struc_ext2 TYPE zsc_s_soawf_badi_acc_doc.
  DATA: ls_ext2       LIKE LINE OF pct_ext2.
  DATA: ls_acc_gl     LIKE LINE OF pct_sach.
  DATA: lv_subrc      TYPE sy-subrc.

  CLEAR pev_subrc.

  ls_acc_gl-itemno_acc        = pis_bseg-buzei.       "Positionsnummer des Rechnungswesenbeleges
  ls_acc_gl-gl_account        = pis_bseg-gkont.       "Sachkonto der Hauptbuchhaltung
  ls_acc_gl-item_text         = pis_bseg-sgtxt.       "Positionstext
  ls_acc_gl-acct_key          = space.                "Vorgangsschl√ºssel
* Bei Kontierung Kreditor auf Anlage mu√ü die Kontoart auf 'A'
* wie Anlage umgestellt werden.
* Ferner brauchen wir das Abstimmkonto der Anlage
* und wir m√ºssen, √ºber die Externen Felder, die Bewegungsart
* mitgeben. Andernfalls bekommen wir keine Anlagenbuchung
  IF NOT pis_bseg-anln1 IS INITIAL.
    ls_acc_gl-acct_type         = 'A'.                "Kontoart
    ls_acc_gl-gl_account        = pis_bseg-gkont.     "Sachkonto der Hauptbuchhaltung
    ls_acc_gl-acct_key          = 'ANL'.              "Vorgangsschl√ºssel f√ºr Anlagenbuchungen (BSCHL 70/75)
    MOVE 'ZSC_S_SOAWF_BADI_ACC_DOC' TO ls_ext2-structure.
    ls_struc_ext2-posnr = pis_bseg-buzei.
    ls_struc_ext2-anbwa = '100'.
    MOVE ls_struc_ext2 TO ls_ext2-valuepart1.
    APPEND ls_ext2 TO pct_ext2.
  ELSE.
    ls_acc_gl-acct_type         = 'S'.                "Kontoart
    ls_acc_gl-gl_account        = pis_bseg-gkont.     "Sachkonto der Hauptbuchhaltung
  ENDIF.

  ls_acc_gl-acct_type         = pis_bseg-koart.       "Kontoart
  ls_acc_gl-tax_code          = pis_bseg-mwskz.       "Mehrwertsteuerkennzeichen
* Standardkontierungen, ggf. erg√§nzen.
  ls_acc_gl-costcenter        = pis_bseg-kostl.       "Kostenstelle
  ls_acc_gl-orderid           = pis_bseg-aufnr.       "Innenauftrag
  ls_acc_gl-asset_no          = pis_bseg-anln1.       "Anlagenhauptnummer
  ls_acc_gl-sub_number        = pis_bseg-anln2.       "Anlagenunternummer

  IF NOT pis_bseg-vbeln IS INITIAL.
    PERFORM add_copa_line USING    pis_bkpf
                                   pis_bseg
                          CHANGING pct_crit
                                   pct_value
                                   lv_subrc.
    IF sy-subrc NE 0.
      pev_subrc = 4.
      RETURN.
    ENDIF.
  ENDIF.

  APPEND ls_acc_gl TO pct_sach.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_COPA_LINE
*&amp;---------------------------------------------------------------------*
*       Schmankerl CO-PA Kontierung
*       Dem BAPI ACC_DOCUMENT_POST m√ºssen die Merkmals- sowie die
*       Wertedaten f√ºr die CO-PA Kontierung mitgegeben werden
*       Hierbei kommt es vor, das von Kundenseite oder der Schnittstellt
*       nur der Kundenauftrag zur Verf√ºgung gestellt wird und die
*       CO-PA Kontierungen dem Programmierer "√ºberlassen" werden.
*       Danke f√ºr die Info ;-)
*       Was tun?
*       Zum Gl√ºck f√ºr uns gibt es den Report RFBIBL00 bzw RFBBIBL01
*       der ebenfalls mit CO-PA Daten best√ºckt werden kann.
*       Hierf√ºr gibt es den Baustein RKE_CONVERT_CRITERIA_PAOBJNR
*       der aus gegegbenen Daten eine neu CO-PA Ableitung f√§hrt
*       aus der man dann die Merkmale nachlesen und dem BAPI unterschieben kann.
******  ACHTUNG !!!!!! ***********
*       Das neue Kontierungsobjekt wird nur dann weggeschrieben und
*       kann nachgelesen werden, wenn ein COMMIT WORK erfolgt!!!!
*       Das ist zwar unsch√∂n aber ich kenne keine andere Methode um an eine
*       komplette Ableitung zu gelangen. Wenn jemand eine kennt, w√§re
*       ich dankbar, wenn diese √∂ffentlich gemacht w√ºrde.
*       Man mu√ü also aufpassen, das man vorher keine Daten auf der
*       Datenbank bereits ge√§ndert oder angelegt hat. Diese w√ºrde
*       hier unweigerlich commited!!!!!
*
*       Das ist aber leider nur die H√§lfte der Wahrheit
*       Wir brauchen leider nicht nur die Merkmale, sondern wir m√ºssen
*       ja auch noch die WErtfelder best√ºcken.
*       Hierzu siehe Routine ADD_VALUE_LINE
*
*       Und als ob das noch nicht reichen w√ºrde, m√ºssen wir die erhaltene
*       Ableitung auch noch durch eine Routine schicken, welche die
*       alle relevanten Konvertierungsexits durchl√§uft, weil der
*       Ableitungsbaustein nur die externe Darstellung (RFBIBL -&gt; BI-Programm)
*       zur√ºckliefert aber nicht die interne, welche das BAPI fordert.
*       Hierzu siehe Routine 'CHANGE_DATA_CONV_EXIT
*       Diese Routine kann man in abgewandelter Form auch benutzen, um
*       z.B. Datenbankdaten f√ºr einen Batch-Input aufzubereiten (z.B.
*       Arbeitspl√§tze oder PSP-Elemente).
*----------------------------------------------------------------------*
FORM add_copa_line  USING    pis_bkpf  TYPE gtys_bkpf
                             pis_bseg  TYPE gtys_bseg
                    CHANGING pct_crit  TYPE bapiackec9_tab
                             pct_value TYPE bapiackev9_tab
                             pev_subrc TYPE sy-subrc.

  DATA: ls_copabbseg TYPE copabbseg.
  DATA: ls_crit      LIKE LINE OF pct_crit.
  DATA: lv_paobjnr   TYPE rkeobjnr.
  DATA: lv_subrc     TYPE sy-subrc.
  DATA: lt_copadata  TYPE gtyt_copadata.
  DATA: ls_copadata  LIKE LINE OF lt_copadata.
  DATA: ls_org_copa  TYPE gtys_org_copa.

  CLEAR pev_subrc.

  IF pis_bseg-vbeln IS INITIAL.
    RETURN.
  ENDIF.

* Zuordnung BURKS zu KOKRS/ERKRS ermitteln
  PERFORM get_orgdata_copa USING    pis_bkpf-bukrs
                           CHANGING ls_org_copa.

* Wertfeldtabelle f√ºllen
  PERFORM add_value_line USING    pis_bkpf
                                  pis_bseg
                                  ls_org_copa-kokrs
                                  ls_org_copa-erkrs
                         CHANGING pct_value
                                  lv_subrc.
  IF lv_subrc NE 0.
    pev_subrc = 4.
    RETURN.
  ENDIF.

* √úbergabe f√ºr Baustein f√ºttern
* Buchungskreis MUSS zwingend gef√ºllt werden
  MOVE: pis_bkpf-bukrs TO ls_copabbseg-rke_bukrs.
  MOVE: pis_bseg-vbeln TO ls_copabbseg-rke_kaufn.
  MOVE: pis_bseg-posnr TO ls_copabbseg-rke_kdpos.

* Neue Ableitung
  CALL FUNCTION 'RKE_CONVERT_CRITERIA_PAOBJNR'
    EXPORTING
      is_copabbseg     = ls_copabbseg
*     i_date           =
    IMPORTING
      e_paobjnr        = lv_paobjnr
    EXCEPTIONS
      no_bukrs_found   = 1
      no_erkrs_found   = 2
      error_criterion  = 3
      error_derivation = 4
      OTHERS           = 5.
  IF sy-subrc &lt;&gt; 0.
*   Fehler bei Ableitung CO-PA Merkmale f√ºr ID &amp; Buzei &amp;.
    pev_subrc = 4.
    RETURN.
  ENDIF.

* Commit Work durchf√ºhren, damit die Ergebnisobjektnummer auf
* der Datenbank vorliegt
  COMMIT WORK  AND WAIT.
  IF sy-subrc NE 0.
*   Fehler bei der Fortschreibung PAOBJNR f√ºr ID &amp; Buzei &amp;.
    pev_subrc = 4.
    RETURN.
  ENDIF.

* Nachlesen der neuen Ableitung
  CALL FUNCTION 'RKE_CONVERT_PAOBJNR_COPADATA'
    EXPORTING
      bukrs          = pis_bkpf-bukrs
      kokrs          = ls_org_copa-kokrs
      paobjnr        = lv_paobjnr
    TABLES
      i_copadata     = lt_copadata
    EXCEPTIONS
      no_erkrs_found = 1
      paobjnr_wrong  = 2
      OTHERS         = 3.
  IF sy-subrc &lt;&gt; 0.
*   Fehler bei Ermittlung Wertfelder aus PAOBJNR f√ºr ID &amp; Buzei &amp;.
    pev_subrc = 4.
    RETURN.
  ENDIF.

* Umstellung der externen Darstellung der Merkmale auf
* interne Werte (durchlaufen der Konvertierungsexits)
  IF NOT lt_copadata IS INITIAL.
    PERFORM change_data_conv_exit USING    ls_org_copa-erkrs
                                  CHANGING lt_copadata.
  ENDIF.

* Anh√§ngen der Merkmale an die Merkmalstabelle f√ºr das BAPI
  LOOP AT lt_copadata INTO ls_copadata.
    IF NOT ls_copadata-fval IS INITIAL.
      CLEAR ls_crit.

      MOVE: pis_bseg-buzei   TO ls_crit-itemno_acc,
            ls_copadata-fnam TO ls_crit-fieldname,
            ls_copadata-fval TO ls_crit-character.
      APPEND ls_crit TO pct_crit.
    ENDIF.
  ENDLOOP.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  GET_ORGDATA_COPA
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_orgdata_copa  USING    piv_bukrs    TYPE bukrs
                       CHANGING pes_org_copa TYPE gtys_org_copa.

  CLEAR pes_org_copa.

  DATA: ls_org_copa    LIKE pes_org_copa.
  DATA: lv_kokrs       TYPE kokrs.
  DATA: lv_erkrs       TYPE erkrs.
  STATICS: lt_org_copa TYPE gtyt_org_copa_hash.

  READ TABLE lt_org_copa INTO ls_org_copa
    WITH TABLE KEY bukrs = piv_bukrs.
  IF sy-subrc EQ 0.
    pes_org_copa = ls_org_copa.
    RETURN.
  ENDIF.

  CALL FUNCTION 'KOKRS_GET_FROM_BUKRS'
    EXPORTING
      i_bukrs        = piv_bukrs
    IMPORTING
      e_kokrs        = lv_kokrs
    EXCEPTIONS
      no_kokrs_found = 1
      OTHERS         = 2.
  IF sy-subrc &lt;&gt; 0.
    MESSAGE ID sy-msgid TYPE 'E' NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  CALL FUNCTION 'COPA_ERKRS_FIND'
    EXPORTING
      bukrs              = piv_bukrs
    IMPORTING
      erkrs              = lv_erkrs
    EXCEPTIONS
      error_kokrs_find   = 1
      kokrs_wrong        = 2
      no_erkrs_defined   = 3
      no_erkrs_for_kokrs = 4
      OTHERS             = 5.
  IF sy-subrc &lt;&gt; 0.
    MESSAGE ID sy-msgid TYPE 'E' NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  MOVE: piv_bukrs TO ls_org_copa-bukrs,
        lv_kokrs  TO ls_org_copa-kokrs,
        lv_erkrs  TO ls_org_copa-erkrs.
  INSERT ls_org_copa INTO TABLE lt_org_copa.
  pes_org_copa = ls_org_copa.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_VALUE_LINE
*&amp;---------------------------------------------------------------------*
*       Das BAPI fordert von uns nicht nur die Merkmale sondern wir
*       m√ºssen auch die Wertfelder best√ºcken - und zwar die richtigen!!!
*
*       Die erreichen wir, indem wir den Baustein
*       COPA_GET_SETTLEMENT_STRUCTURE benutzen. Dieser gibt uns
*       das Ergebnisschmema, die Zuordnung sowie den Inhalt der Tabelle
*       TKB9F zur√ºck.
*       Hierzu mu√ü man wissen, das f√ºr das Konto, auf welches gebucht
*       werden soll, im Customizing hinterlegt sein MUSS, auf welches
*       Wertfeld die Betr√§ge laufen sollen.
*       Also lesen wir zun√§chst mit dem Baustein Schema und Zuordnung
*       und dann damit die Tabelle.
*       Nicht wundern, das hier bestimmte Werte hart verdrahtet sind.
*       Das ist so und mu√ü auch so gecustomized sein.
*       Es MUSS ein Wertfeld sein (MWKZ = 1) und das Fix-/Variabel Kz.
*       MUSS auf Gesamtwert (FVKZ = 3) stehen. Ist das nicht der Fall,
*       ist dies ein Fehler!!!!
*       Hat man vor mehrere Belege f√ºr unterschiedliche W√§hrungs-
*       sichten zu erzeugen, so mu√ü man dies auch hier tun. Im diesem
*       Beispiel nehmen wir nur die Belegw√§hrung
*----------------------------------------------------------------------*
FORM add_value_line USING    pis_bkpf  TYPE gtys_bkpf
                             pis_bseg  TYPE gtys_bseg
                             piv_kokrs TYPE kokrs
                             piv_erkrs TYPE erkrs
                    CHANGING pct_value TYPE bapiackev9_tab
                             pev_subrc TYPE sy-subrc.

  DATA: lt_9f TYPE STANDARD TABLE OF tkb9f.
  DATA: ls_9f LIKE LINE OF lt_9f.
  DATA: lv_ersch TYPE tkb9f-ersch.
  DATA: lv_erzuo TYPE tkb9f-erzuo.

  DATA: ls_value LIKE LINE OF pct_value.
  DATA: BEGIN OF ls_wertfeld,
          hkont  TYPE bseg-hkont,
          wrtfld TYPE fieldname,
        END OF ls_wertfeld.
  STATICS: lt_wertfeld LIKE HASHED TABLE OF ls_wertfeld
                       WITH UNIQUE KEY hkont.

  CLEAR pev_subrc.

* Statische Wertfeldtabelle lesen (damit es schneller geht)
  READ TABLE lt_wertfeld INTO ls_wertfeld
    WITH TABLE KEY hkont = pis_bseg-gkont.
  IF sy-subrc EQ 0.
    MOVE: pis_bseg-buzei     TO ls_value-itemno_acc,
          ls_wertfeld-wrtfld TO ls_value-fieldname,
          '00'               TO ls_value-curr_type,
          pis_bkpf-waers     TO ls_value-currency,
          pis_bkpf-waers     TO ls_value-currency_iso,
          pis_bseg-netto     TO ls_value-amt_valcom.
    APPEND ls_value TO pct_value.
    RETURN.
  ENDIF.

* Ansonsten Ergebnisschema und -zuordnung ermitteln
  CALL FUNCTION 'COPA_GET_SETTLEMENT_STRUCTURE'
    EXPORTING
      i_erkrs              = piv_erkrs
      i_vrgng              = 'RFBU'
      i_hkont              = pis_bseg-gkont
      i_kokrs              = piv_kokrs
    IMPORTING
      e_ersch              = lv_ersch
      e_erzuo              = lv_erzuo
    TABLES
      t_tkb9f              = lt_9f
    EXCEPTIONS
      incomplete_structure = 1
      error_structure      = 2
      OTHERS               = 3.
  IF sy-subrc &lt;&gt; 0.
*   Wertfeld f√ºr Bukrs &amp; Konto &amp; kann nicht ermittelt werden (&amp;).
    pev_subrc = 4.
    RETURN.
  ENDIF.

* TKB9F mit den ermittelten Werten lesen
  READ TABLE lt_9f INTO ls_9f WITH KEY ersch = lv_ersch
                                       erzuo = lv_erzuo
                                       erkrs = piv_erkrs
                                       mwkz  = '1'
                                       fvkz  = '3'.
  IF sy-subrc NE 0.
*   Ist hier nichts zu finden, ist dies ein Fehler und der Beleg
*   w√ºrde sowieso aufbrummen - also Schlu√ü
*   Wertfeld f√ºr Bukrs &amp; Konto &amp; kann nicht ermittelt werden (&amp;)
    pev_subrc = 4.
    RETURN.
  ENDIF.

* Value R√ºckgabetabelle f√ºllen
  MOVE: pis_bseg-buzei TO ls_value-itemno_acc,
        ls_9f-wrtfld   TO ls_value-fieldname,
        '00'           TO ls_value-curr_type,
        pis_bkpf-waers TO ls_value-currency,
        pis_bkpf-waers TO ls_value-currency_iso,
        pis_bseg-netto TO ls_value-amt_valcom.
  APPEND ls_value TO pct_value.

* Und zum Schlu√ü noch die statische Wertfeldtabelle erweitern
  MOVE: pis_bseg-gkont TO ls_wertfeld-hkont,
        ls_9f-wrtfld   TO ls_wertfeld-wrtfld.
  INSERT ls_wertfeld INTO TABLE lt_wertfeld.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  CHANGE_DATA_CONV_EXIT
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM change_data_conv_exit  USING    piv_erkrs TYPE erkrs
                            CHANGING pct_data  TYPE gtyt_copadata.

  DATA: BEGIN OF ls_ddic,
          tabname   TYPE dfies-tabname,
          fieldname TYPE dfies-fieldname,
          rollname  TYPE dfies-rollname,
          convexit  TYPE dfies-convexit,
          funcname  TYPE tfdir-funcname,
          reference TYPE REF TO data,
        END OF ls_ddic,
        lt_ddic LIKE HASHED TABLE OF ls_ddic
                WITH UNIQUE KEY tabname fieldname.
  DATA: lt_ddic_info TYPE ddfields.
  DATA: ls_ddic_info LIKE LINE OF lt_ddic_info.
  DATA: lv_tabname   TYPE tabname.
  DATA: lv_fieldname TYPE fieldname.
  DATA: lv_value     TYPE REF TO data.

  FIELD-SYMBOLS: &lt;ls_data&gt;  LIKE LINE OF pct_data,
                 &lt;lv_value&gt; TYPE any.


  CONCATENATE 'CE0' piv_erkrs INTO lv_tabname.

  LOOP AT pct_data ASSIGNING &lt;ls_data&gt;.
    CHECK NOT &lt;ls_data&gt;-fval IS INITIAL.
    CLEAR: lv_tabname, ls_ddic.

    CONCATENATE 'CE0' piv_erkrs INTO lv_tabname.
    CONDENSE lv_tabname.

    MOVE &lt;ls_data&gt;-fnam TO lv_fieldname.
    READ TABLE lt_ddic INTO ls_ddic
      WITH TABLE KEY tabname   = lv_tabname
                     fieldname = lv_fieldname.
    IF sy-subrc EQ 0.
      IF ls_ddic-funcname IS INITIAL.
        CONTINUE.
      ENDIF.
    ELSE.
      CALL FUNCTION 'DDIF_FIELDINFO_GET'
        EXPORTING
          tabname        = lv_tabname
          fieldname      = lv_fieldname
        TABLES
          dfies_tab      = lt_ddic_info
        EXCEPTIONS
          not_found      = 1
          internal_error = 2
          OTHERS         = 3.
      IF sy-subrc &lt;&gt; 0.
        MESSAGE ID sy-msgid TYPE 'E' NUMBER sy-msgno
                WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
      ENDIF.
      CLEAR ls_ddic.
      READ TABLE lt_ddic_info INTO ls_ddic_info INDEX 1.
      MOVE-CORRESPONDING ls_ddic_info TO ls_ddic.
      IF NOT ls_ddic-convexit IS INITIAL.
        CONCATENATE 'CONVERSION_EXIT_' ls_ddic_info-convexit '_INPUT'
                    INTO ls_ddic-funcname.
        CONDENSE ls_ddic-funcname.
        CREATE DATA lv_value TYPE (ls_ddic-rollname).
        MOVE lv_value TO ls_ddic-reference.
      ENDIF.
      INSERT ls_ddic INTO TABLE lt_ddic.
    ENDIF.
    IF NOT ls_ddic-funcname IS INITIAL.
      ASSIGN ls_ddic-reference-&gt;* TO &lt;lv_value&gt;.
      MOVE &lt;ls_data&gt;-fval TO &lt;lv_value&gt;.
      CALL FUNCTION ls_ddic-funcname
        EXPORTING
          input  = &lt;lv_value&gt;
        IMPORTING
          output = &lt;lv_value&gt;
        EXCEPTIONS
          OTHERS = 0.
      CLEAR &lt;ls_data&gt;-fval.
      MOVE &lt;lv_value&gt; TO &lt;ls_data&gt;-fval.
    ENDIF.
  ENDLOOP.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  GET_TAX
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_tax  USING    pis_bkpf  TYPE gtys_bkpf
                       pis_bseg  TYPE gtys_bseg
                       piv_tabix TYPE sy-tabix
              CHANGING pct_tax   TYPE gtyt_tax.

  DATA: lv_amount TYPE bseg-wrbtr.
  DATA: lt_mwdat  TYPE STANDARD TABLE OF rtax1u15.
  DATA: ls_mwdat  LIKE LINE OF lt_mwdat.
  DATA: ls_tax    TYPE gtys_tax.
  DATA: lt_tax    TYPE gtyt_tax.

* Nur Steuer auf Positions-, nicht auf Kopfzeilen
  IF piv_tabix EQ 1.
    RETURN.
  ENDIF.

* Steuerkennzeichen mu√ü mitgegeben sein
  IF NOT pis_bseg-mwskz IS INITIAL.
*   ACHTUNG
*   Der Baustein ermittelt die Steuer abh√§ngig vom
*   √ºbergebenen Wert. Da wir mit positiven Werten arbeiten
*   m√ºssen wir hier nat√ºrlich auch ggf. das Vorzeichen drehen
*   sonst geht es schief.
    lv_amount = pis_bseg-netto.
    IF pis_bseg-shkzg EQ 'H'.
      lv_amount = pis_bseg-netto * -1.
    ENDIF.

*   Baustein f√ºr Ermittlung der Steuer aus dem Nettowert
*   Anmerkung: Gibt es auch f√ºr Bruttowerte
*              CALCULATE_TAX_FROM_GROSSAMOUNT
    CALL FUNCTION 'CALCULATE_TAX_FROM_NET_AMOUNT'
      EXPORTING
        i_bukrs           = pis_bkpf-bukrs
        i_mwskz           = pis_bseg-mwskz
        i_waers           = pis_bkpf-waers
        i_wrbtr           = lv_amount
      TABLES
        t_mwdat           = lt_mwdat
      EXCEPTIONS
        bukrs_not_found   = 1
        country_not_found = 2
        mwskz_not_defined = 3
        mwskz_not_valid   = 4
        ktosl_not_found   = 5
        kalsm_not_found   = 6
        parameter_error   = 7
        knumh_not_found   = 8
        kschl_not_found   = 9
        unknown_error     = 10
        account_not_found = 11
        txjcd_not_valid   = 12
        OTHERS            = 13.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE 'E' NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
    LOOP AT lt_mwdat INTO ls_mwdat.
      MOVE-CORRESPONDING ls_mwdat TO ls_tax                 ##ENH_OK.
*     Wir brauchen f√ºr die Steuerzeilen aber auch noch das Steuerkenn-
*     zeichen. Daher umkopieren auf eigene Struktur
      MOVE: pis_bseg-mwskz TO ls_tax-mwskz.
      APPEND ls_tax TO lt_tax.
    ENDLOOP.
    IF NOT lt_mwdat IS INITIAL.
      APPEND LINES OF lt_tax TO pct_tax.
    ENDIF.
  ENDIF.

ENDFORM.
*&amp;---------------------------------------------------------------------*
*&amp;      Form  ADD_TAX_LINES
*&amp;---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM add_tax_lines  USING    pit_tax    TYPE gtyt_tax
                             pis_bkpf   TYPE gtys_bkpf
                             piv_buzei  TYPE bseg-buzei
                    CHANGING pct_acc_tx TYPE bapiactx09_tab
                             pct_cur_am TYPE bapiaccr09_tab.

  DATA: ls_tax    LIKE LINE OF pit_tax.
  DATA: ls_acc_tx LIKE LINE OF pct_acc_tx.
  DATA: ls_cur_am LIKE LINE OF pct_cur_am.
  DATA: lv_buzei  TYPE bseg-buzei.

  DATA: BEGIN OF ls_collect,
          mwskz TYPE mwskz,
          kschl TYPE kschl,
          ktosl TYPE ktosl,
          hkont TYPE hkont,
          wmwst TYPE wmwst,
          kawrt TYPE kawrt,
        END OF ls_collect.
  DATA: lt_collect LIKE HASHED TABLE OF ls_collect
                   WITH UNIQUE KEY mwskz ktosl kschl hkont.

* Steuern m√ºssen wir schon ermittelt haben
  IF NOT pit_tax IS INITIAL.

*   √úber den Collect werden Steuer und Steuerbasis summiert
*   und ggf. verdichtet
    LOOP AT pit_tax INTO ls_tax.
      MOVE-CORRESPONDING ls_tax TO ls_collect.
      COLLECT ls_collect INTO lt_collect.
    ENDLOOP.

*   Wir kopieren die letzte Zeilennummer
    lv_buzei = piv_buzei.

*   Und los
    LOOP AT lt_collect INTO ls_collect.
*     Eins auf die Buchungszeile da wir eine neue
*     Zeile erzuegen
      ADD 1 TO lv_buzei.
      CLEAR ls_acc_tx.
*     √úbertragung der Steuerdaten
      MOVE: lv_buzei         TO ls_acc_tx-itemno_acc,
            ls_collect-hkont TO ls_acc_tx-gl_account,
            ls_collect-kschl TO ls_acc_tx-cond_key,
            ls_collect-ktosl TO ls_acc_tx-acct_key,
            ls_collect-mwskz TO ls_acc_tx-tax_code.
*     Und anh√§ngen
      APPEND ls_acc_tx TO pct_acc_tx.

*     Da dies nur die Parameter f√ºr die Steuerzeile sind,
*     m√ºssen wir auch noch eine Wertezeile erzeugen
      CLEAR ls_cur_am.
*     Gleiche Zeile wie Steuerzeile (Bezug!!!)
      MOVE: lv_buzei         TO ls_cur_am-itemno_acc,
            pis_bkpf-waers   TO ls_cur_am-currency,
            pis_bkpf-waers   TO ls_cur_am-currency_iso,
*           Ermittelter, summierter Steuerwert f√ºr Steuerkennzeichen
            ls_collect-wmwst TO ls_cur_am-amt_doccur,
*           Ermittelter, summierter Basiswert f√ºr Steuerkennzeichen
            ls_collect-kawrt TO ls_cur_am-amt_base,
            '00'             TO ls_cur_am-curr_type,
*           Umrechnungskurs f√ºr Fremdw√§hrung
*           ACHTUNG!!!
*           Entweder hier KURSF ODER!!!! im Kopf WWERT mitgeben!!!
            pis_bkpf-kursf   TO ls_cur_am-exch_rate.
      APPEND ls_cur_am TO pct_cur_am.
    ENDLOOP.
  ENDIF.

ENDFORM.
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Der Beitrag <a href="/blog/buchungsbelege-erstellen/">Buchungsbelege erstellen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>SimDia¬≤ als Alternative zur Programmierung?</title>
		<link>/blog/simdia%c2%b2-als-alternative-zur-programmierung/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Mon, 15 Jan 2018 16:44:36 +0000</pubDate>
				<category><![CDATA[AddOns]]></category>
		<category><![CDATA[Partner]]></category>
		<category><![CDATA[Featured]]></category>
		<category><![CDATA[Programmierung]]></category>
		<category><![CDATA[Module]]></category>
		<category><![CDATA[simdia]]></category>
		<category><![CDATA[migration]]></category>
		<category><![CDATA[programmierung]]></category>
		<category><![CDATA[LSMW]]></category>
		<guid isPermaLink="false">https://tricktresor.com/?p=1018330</guid>

					<description><![CDATA[<p>F√ºr Datenimporte muss man programmieren oder sich mit der LSMW auskennen. Beides Tools, die dem Anwender in der Regel nicht zur Verf√ºgung stehen. Hier ist SimDia¬≤ das ideale Tool. Allerdings nicht nur f√ºr Fachanwender und Key-User...</p>
<p>Der Beitrag <a href="/blog/simdia%c2%b2-als-alternative-zur-programmierung/">SimDia¬≤ als Alternative zur Programmierung?</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>√úber mein Lieblings-AddOn <a href="https://ersasoft.de/de/simdia/?s=tt">SimDia¬≤</a> habe ich ja bereits mehrmals geschrieben (<a href="https://tricktresor.com/blog/simdia2-sap-datenimport-einfach/">SAP Datenimport einfach?</a>, <a href="https://tricktresor.com/blog/simdia2-neue-version-des-besten-sap-import-tools/">Neue Version SimDia¬≤</a> und <a href="https://tricktresor.com/blog/logik-vs-daten-sap-vs-simdia%c2%b2-programmierer-vs-anwender/">Logik vs. Daten</a>). Grund daf√ºr waren die gro√üe Funktionalit√§t und die extrem einfache Handhabung. Beides erm√∂glicht es auch Endanwendern und Nicht-Informatikern, sehr schnell &#8211; also in wenigen Minuten &#8211; einen Datenaustausch zwischen Excel und SAP zu definieren und automatisch ausf√ºhren zu lassen.</p>
<p>Mein Problem als leidenschaftlicher Programmierer und ‚ÄûDatenmaltr√§tierer‚Äú war aber bisher immer, dass mir ein bisschen die ‚ÄûAnwender-Brille‚Äú fehlte und damit entsprechende Anwendungsf√§lle. In meinem Arbeitsalltag habe ich n√§mlich mit Datenimport-Anfragen nicht wirklich zu tun (wor√ºber ich aber ehrlicherweise gar nicht traurig bin). Und wenn doch, dann habe ich ja dieses Tool zum <em>Extreme Customizing</em>: ABAP. Daher ging ich bis vor kurzem davon aus, dass SimDia¬≤ vor allem ein Tool f√ºr Fachabteilungen und Endanwender zur L√∂sung kleinerer und einfacher Datenimport-Aufgaben ist.</p>
<p>Das Problem eines Entwicklers in meiner Xing-Gruppe <a href="https://www.xing.com/communities/groups/tricktresor-f8f4-1000599">Tricktresor</a> ¬†zum Thema <a href="https://www.xing.com/communities/posts/aufzeichnung-in-lsmw-sekundaerressourcen-pflegen-1014264586">Aufzeichnung in LSMW (Sekund√§rressourcen pflegen)</a> brachte mich jedoch zu der Frage, ob und wie sich der dort geschilderte und recht komplexe Vorgang statt mit LSMW auch mit SimDia¬≤ l√∂sen lie√üe. Kurz und gut: mit ein wenig Auffrischung im Umgang mit SimDia¬≤ (was mir bis dahin aus oben erw√§hnten Gr√ºnden etwas gefehlt hatte) lie√ü sich die gesamte Aufgabe schlussendlich in nur 2-3 Minuten l√∂sen.</p>
<h2>Aufzeichnung mit SimDia¬≤</h2>
<p>Im Grunde reicht es, wenn man die betreffende SAP-Transaktion gut kennt (in diesem Fall die mir bis dahin unbekannte C202) und ein wenig wei√ü, wie SAP tickt. Da die gesamte SimDia¬≤-Aufzeichnung im normalen SAP GUI-Dialog stattfindet, verschwinden auch keine Registerkarten (wie teilweise beim Batchinput) und nach dem Text¬†<em>Planungs-Vorgang</em> l√§sst sich sehr einfach in der Tabelle suchen. Der einzige Trick besteht dann noch darin, den gefundenen Vorgang zu markieren. Aber auch das verr√§t SAP einem nach beherztem Druck auf die rechte Maustaste:</p>
<p><a href="https://tricktresor.com/wp-content/uploads/2018/01/sd01.png"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-1018332" src="https://tricktresor.com/wp-content/uploads/2018/01/sd01.png" alt="" width="313" height="61" srcset="/wp-content/uploads/2018/01/sd01.png 313w, /wp-content/uploads/2018/01/sd01-300x58.png 300w" sizes="(max-width: 313px) 100vw, 313px" /></a></p>
<p>Anschlie√üend lassen sich die Sekund√§rressourcen ganz einfach ebenfalls √ºber das Kontext-Men√º ¬†aufrufen und versorgen.</p>
<p><a href="https://tricktresor.com/wp-content/uploads/2018/01/sd02.png"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-1018331" src="https://tricktresor.com/wp-content/uploads/2018/01/sd02.png" alt="" width="314" height="64" srcset="/wp-content/uploads/2018/01/sd02.png 314w, /wp-content/uploads/2018/01/sd02-300x61.png 300w" sizes="(max-width: 314px) 100vw, 314px" /></a></p>
<p><a href="https://tricktresor.com/wp-content/uploads/2018/01/sd03.png"><img loading="lazy" decoding="async" class="alignnone size-large wp-image-1018333" src="https://tricktresor.com/wp-content/uploads/2018/01/sd03-1024x590.png" alt="" width="640" height="369" srcset="/wp-content/uploads/2018/01/sd03-1024x590.png 1024w, /wp-content/uploads/2018/01/sd03-300x173.png 300w, /wp-content/uploads/2018/01/sd03-768x442.png 768w, /wp-content/uploads/2018/01/sd03-265x153.png 265w, /wp-content/uploads/2018/01/sd03-148x85.png 148w, /wp-content/uploads/2018/01/sd03-193x112.png 193w, /wp-content/uploads/2018/01/sd03-71x40.png 71w, /wp-content/uploads/2018/01/sd03.png 1502w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<h2>Nur f√ºr Fachabteilungen?</h2>
<p>Ist SimDia¬≤ also ‚Äûnur‚Äú ein Tool f√ºr Fachabteilungen und Endanwender zur L√∂sung kleinerer Datenimport-Aufgaben? Mitnichten.</p>
<p>Nachdem bei mir der Knoten geplatzt war &#8211; sp√§testens, als ich gesehen hatte, wie einfach auch die <a href="https://ersasoft.de/de/videos/?s=tt#Tutorial6">Verarbeitung von Kopf- und Detaildaten</a> damit ist &#8211; wurde mir klar, dass mit SimDia¬≤ eben auch komplexe F√§lle abgebildet werden k√∂nnen. Auch solche, f√ºr die in der LSMW geballtes Entwickler-Gehirnschmalz und manchmal sogar ABAP n√∂tig sind.</p>
<p>Denn auf diese Weise k√∂nnen &#8211; und da m√ºssen wir Entwickler jetzt ganz stark sein<img src="https://s.w.org/images/core/emoji/14.0.0/72x72/1f609.png" alt="üòâ" class="wp-smiley" style="height: 1em; max-height: 1em;" /> &#8211; auch ganz ‚Äûnormale‚Äú SAP-Anwender komplexe Datenimporte durchf√ºhren. Wenn man mal kurz dar√ºber nachdenkt, ist das doch aber gar nicht so verkehrt. Warum? Weil dadurch die Aufgaben von denjenigen erledigt werden k√∂nnen, die sich mit den Daten ohnehin am besten auskennen. Und wir Entwickler k√∂nnen uns auf das konzentrieren, wof√ºr wir eigentlich ausgebildet wurden und bezahlt werden: komplexe Software-L√∂sungen entwickeln und unsere Unternehmen fit zu machen f√ºr die Zukunft. Au√üerdem sagt ja keiner, dass wir SimDia¬≤ nicht auch f√ºr unsere Zwecke einsetzen k√∂nnen, falls z. B. die Datenimporte weiterhin von der IT durchgef√ºhrt werden sollen. Wenn wir Aufgaben in ein paar Minuten erledigen k√∂nnen, f√ºr die vorher einige Stunden n√∂tig waren, dann beschwert sich dar√ºber sicher auch niemand.</p>
<h2>SimDia¬≤</h2>
<p>Mehr Informationen zu SimDia¬≤ findest du auf der Homepage: <a href="https://ersasoft.de/de/simdia/?s=tt">https://ersasoft.de/</a></p>
<h2>Erfahrungsberichte</h2>
<p>Da ich selbst SimDia¬≤ in der Praxis noch nicht eingesetzt habe (ich darf zum Gl√ºck tun, wof√ºr ich ausgebildet wurde und bezahlt werde<img src="https://s.w.org/images/core/emoji/14.0.0/72x72/1f609.png" alt="üòâ" class="wp-smiley" style="height: 1em; max-height: 1em;" />), interessieren mich nat√ºrlich einschl√§gige Erfahrungen. Falls ihr also weitere Beispiele f√ºr mich habt, in denen ihr komplexe Datentransfers mit SimDia¬≤ erledigt habt, f√ºr die vorher eine aufwendige LSMW-Programmierung notwendig war, dann gerne immer her damit!</p>
<p><br />
[accordian]</p>
<h2>Tricktresor- Bonus</h2>
<p>[accordian_list title=&#8217;Sichere dir einen 5%-Rabatt auf SimDia¬≤!&#8217;]</p>
<p><em>Da SimDia¬≤ eine professionelle Software f√ºr SAP-Nutzer ist, benutze bitte deine Firmen-Mailadresse. SAP-Berater k√∂nnen einen entsprechenden Hinweis in die Nachricht schreiben.</em></p>
<p>[notice type=&#8217;info&#8217;]</p>
<p>[contact-form-7]</p>
<p>[/notice]</p>
<p>[/accordian_list]</p>
<p>[/accordian]</p>
<p></p>
<p>Der Beitrag <a href="/blog/simdia%c2%b2-als-alternative-zur-programmierung/">SimDia¬≤ als Alternative zur Programmierung?</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>Fertigungsauftrag r√ºckmelden</title>
		<link>/blog/fertigungsauftrag-rueckmelden/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Sat, 01 Apr 2017 01:30:54 +0000</pubDate>
				<category><![CDATA[Produktion]]></category>
		<category><![CDATA[Programmierung]]></category>
		<guid isPermaLink="false">https://tricktresor.com/?p=1017978</guid>

					<description><![CDATA[<p>Ein kurzes und knappes Code-Beispiel um eine R√ºckmeldung zu einem Fertigungsauftrag mit Hilfe des Bausteins BAPI_PRODORDCONF_CREATE_TT zu erfassen. Die R√ºckmeldedaten werden erfasst und dann dem Baustein √ºbergeben.</p>
<p>Der Beitrag <a href="/blog/fertigungsauftrag-rueckmelden/">Fertigungsauftrag r√ºckmelden</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>Ein kurzes und knappes Code-Beispiel um eine R√ºckmeldung zu einem Fertigungsauftrag mit Hilfe des Bausteins BAPI_PRODORDCONF_CREATE_TT zu erfassen. Die R√ºckmeldedaten werden erfasst und dann dem Baustein √ºbergeben.</p>
<p>Um das ganze etwas interessanter zu machen, verwende ich die neuen ABAP-740 Sprachfeatures VALUE und SWITCH&#8230;</p>
<p><a href="https://tricktresor.com/wp-content/uploads/2017/04/2017-04-01_03-30-09.jpg"><img loading="lazy" decoding="async" class="size-full wp-image-1017981 alignnone" src="https://tricktresor.com/wp-content/uploads/2017/04/2017-04-01_03-30-09.jpg" alt="" width="587" height="410" srcset="/wp-content/uploads/2017/04/2017-04-01_03-30-09.jpg 587w, /wp-content/uploads/2017/04/2017-04-01_03-30-09-300x210.jpg 300w, /wp-content/uploads/2017/04/2017-04-01_03-30-09-200x140.jpg 200w" sizes="(max-width: 587px) 100vw, 587px" /></a></p>
<h2>Time Ticket f√ºllen</h2>
<pre class=""> append value #(
   "R√ºckmeldedaten f√ºllen
    orderid        = aufnr
    operation      = vornr
    work_cntr      = arbpl
    plant          = werks
    postg_date     = sy-datum
    conf_text      = |R√ºckmeldung Hugo|
    yield          = gutmenge
    conf_quan_unit = 'ST'
    recordtype     = COND #( WHEN gutmenge &gt;= gesamtmenge THEN 'L40' ELSE 'L20' )
  ) TO tickets.</pre>
<h2>R√ºckmeldung buchen</h2>
<pre class=""> DATA return     TYPE bapiret1.
 DATA return_det TYPE STANDARD TABLE OF bapi_coru_return.
 DATA return_det TYPE bapi_coru_return.

 "R√ºckmeldung buchen
 CALL FUNCTION 'BAPI_PRODORDCONF_CREATE_TT'
   EXPORTING
     post_wrong_entries = '0'
     testrun       = abap_false
   IMPORTING
     return        = return
   TABLES
     timetickets   = tickets
     detail_return = return_det.
</pre>
<p>Wie bei allen BAPIs muss die Buchung durch ein BAPI_TRANSACTION_COMMIT best√§tigt werden</p>
<p>Der Beitrag <a href="/blog/fertigungsauftrag-rueckmelden/">Fertigungsauftrag r√ºckmelden</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>Vorgang im Fertigungsauftrag anlegen</title>
		<link>/blog/vorgang-im-fertigungsauftrag-anlegen/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Sat, 01 Apr 2017 00:27:00 +0000</pubDate>
				<category><![CDATA[Produktion]]></category>
		<category><![CDATA[Fertigungsauftrag]]></category>
		<category><![CDATA[Vorgang]]></category>
		<guid isPermaLink="false">https://tricktresor.com/?p=1017973</guid>

					<description><![CDATA[<p>BAPIs sollten eigentlich programmtechnisch das m√∂glich machen, was auch im Dialog m√∂glich ist. Leider gibt es sehr viele Unterschiede zwischen BAPI und entsprechender Dialog-Transaktion.</p>
<p>Im Produktionsumfeld ist es so, dass ein Fertigungsauftrag gar nicht komplett mit Hilfe von BAPIs angelegt werden kann. Die Anlage bzw. √Ñnderung muss in mehrere Schritten erfolgen. Normalerweise reicht es dem BAPI_PRODORD_CREATE unter Angabe einer Materialnummer und eines Werkes um einen Fertigungsauftrag anzulegen.</p>
<p>Der Beitrag <a href="/blog/vorgang-im-fertigungsauftrag-anlegen/">Vorgang im Fertigungsauftrag anlegen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>BAPIs sollten eigentlich programmtechnisch das m√∂glich machen, was auch im Dialog m√∂glich ist. Leider gibt es sehr viele Unterschiede zwischen BAPI und entsprechender Dialog-Transaktion.</p>
<p>Im Produktionsumfeld ist es so, dass ein Fertigungsauftrag gar nicht komplett mit Hilfe von BAPIs angelegt werden kann. Die Anlage bzw. √Ñnderung muss in mehrere Schritten erfolgen. Normalerweise reicht es dem BAPI_PRODORD_CREATE unter Angabe einer Materialnummer und eines Werkes um einen Fertigungsauftrag anzulegen.</p>
<p>Aber nat√ºrlich gibt es immer Umst√§nde, die eine gezielte Anlage oder Manipulation des Fertigungsauftrags notwendig machen. In diesem Beispiel zeige ich die Anlage eines Vorgangs. Hierf√ºr gibt es leider keinen BAPI und ich verwende den Baustein CO_SE_PRODORD_CHANGE, da dieser problemlos separat aufzurufen war. Es gibt noch den Baustein CO_XT_OPERATION_CHANGE, der jedoch Vorbereitungen mit anderen CO_XT-Bausteinen ben√∂tigt.</p>
<h2>Code</h2>
<pre class="">"Lokale Daten
 DATA lv_aufnr TYPE aufnr.
 DATA ls_return TYPE bapiret2.
 DATA lt_operations TYPE cose_t_operation.
 DATA ls_operation TYPE cose_s_operation.
 DATA ls_header TYPE cose_s_header.

"Vorgangsdaten
 ls_operation-standard_value_01 = data-vgw01.
 ls_operation-standard_value_01_unit = data-vge01.
 ls_operation-standard_value_02 = data-vgw02.
 ls_operation-standard_value_02_unit = data-vge02.
 ls_operation-short_text = data-vorgangstext.

 ls_operation-sequence = space.
 ls_operation-operation = data-vornr.
 ls_operation-work_center = data-arbpl.
 ls_operation-control_key = data-steus.¬†
 ls_operation-earliest_end_exec_date = data-endtermin.
 ls_operation-earliest_end_exec_time = '210000'.
 ls_operation-base_quantity = data-menge.
 ls_operation-dispatch_indicator = abap_false.
 ls_operation-user_field_02_character = data-xyz.

 ls_operation-standard_value_01_x = abap_true.
 ls_operation-standard_value_01_unit_x = abap_true.
 ls_operation-standard_value_02_x = abap_true.
 ls_operation-standard_value_02_unit_x = abap_true.
 ls_operation-work_center_x = abap_true.
 ls_operation-earliest_end_exec_date_x = abap_true.
 ls_operation-earliest_end_exec_time_x = abap_true.
 ls_operation-short_text_x = abap_true.
 ls_operation-base_quantity_x = abap_true.
 ls_operation-user_field_02_character_x = abap_true.
 APPEND ls_operation TO lt_operations.

 SET UPDATE TASK LOCAL.

"Anlage/ √Ñnderung des Vorgangs
 CALL FUNCTION 'CO_SE_PRODORD_CHANGE'
   EXPORTING
     iv_order_number = lv_aufnr
     is_header = ls_header
     it_operation = lt_operations
     iv_commit = abap_true
   IMPORTING
     es_return = ls_return.
     export_werks_to_memory( space ).

 IF ls_return IS INITIAL.
   COMMIT WORK.
 ELSE.
   RAISE EXCEPTION TYPE zcx_order.
 ENDIF.</pre>
<h2>Keine Werks√§nderung m√∂glich</h2>
<p>Leider hat der verwendete Baustein eine Einschr√§nkung, die es im Dialog nicht gibt: Es kann kein abweichendes Werk im Vorgang √ºbergeben werden. Dies war jedoch zwingend notwendig. Ich wusste dann keine andere M√∂glichkeit, als an geeigneter Stelle eine Erweiterungsimplementierung zu erstellen, die das vom Baustein gefundene Default-Werk √ºberschreibt.</p>
<p><a href="https://tricktresor.com/wp-content/uploads/2017/04/2017-04-01_02-25-13.jpg"><img loading="lazy" decoding="async" class="size-full wp-image-1017975 alignnone" src="https://tricktresor.com/wp-content/uploads/2017/04/2017-04-01_02-25-13.jpg" alt="" width="593" height="573" srcset="/wp-content/uploads/2017/04/2017-04-01_02-25-13.jpg 593w, /wp-content/uploads/2017/04/2017-04-01_02-25-13-300x290.jpg 300w" sizes="(max-width: 593px) 100vw, 593px" /></a></p>
<p>Die Erweiterung habe ich im Programm¬†LCO_SEF03 am Ende der FORM-Routine <strong>opr_set_default_values</strong> gesetzt. Vor Aufruf des Bausteins CO_SE_PROORD_CHANGE exportiere ich das zu verwendende Werk √ºber EXPORT TO MEMORY in den SAP-Speicher. Die Erweiterungsimplementierung √ºberschreibt das Feld¬†gs_afvgd-werks ¬†mittels IMPORT FROM MEMORY (sofern vorhanden). Hiermit ist nur die Anlage oder √Ñnderung <strong>eines</strong> Vorgangs m√∂glich. F√ºr das √Ñndern mehrerer Vorg√§nge muss die Logik entsprechend angepasst werden und man muss in der Erweiterung pr√ºfen, welcher Vorgang gerade bearbeitet wird.</p>
<p>Der Beitrag <a href="/blog/vorgang-im-fertigungsauftrag-anlegen/">Vorgang im Fertigungsauftrag anlegen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>Komponenten einem Fertigungsauftrag hinzuf√ºgen</title>
		<link>/blog/komponenten-einem-fertigungsauftrag-hinzufuegen/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Fri, 31 Mar 2017 23:42:35 +0000</pubDate>
				<category><![CDATA[Produktion]]></category>
		<category><![CDATA[Programmierung]]></category>
		<category><![CDATA[Komponente]]></category>
		<category><![CDATA[Fertigungsauftrag]]></category>
		<guid isPermaLink="false">https://tricktresor.com/?p=1017963</guid>

					<description><![CDATA[<p>F√ºr den Fertigungsauftr√§ge sind die BAPIs leider sehr rar ges√§t und man muss auf andere Bausteine ausweichen. Um einem Auftrag Komponenten hinzuzuf√ºgen, habe ich nur den Baustein CO_XT_COMPONENT_ADD gefunden. Die CO_XT-Funktionsbausteine sind zwar prinzipiell "extern" und in der Funktionsgruppe "APIs Fertigungsauftrag", jedoch sind die Bausteine allesamt sehr mit Vorsicht zu genie√üen.</p>
<p>Der Beitrag <a href="/blog/komponenten-einem-fertigungsauftrag-hinzufuegen/">Komponenten einem Fertigungsauftrag hinzuf√ºgen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>F√ºr den Fertigungsauftr√§ge sind die BAPIs leider sehr rar ges√§t und man muss auf andere Bausteine ausweichen. Um einem Auftrag Komponenten hinzuzuf√ºgen, habe ich nur den Baustein¬†CO_XT_COMPONENT_ADD gefunden. Die CO_XT-Funktionsbausteine sind zwar prinzipiell &#8220;extern&#8221; und in der Funktionsgruppe &#8220;APIs Fertigungsauftrag&#8221;, jedoch sind die Bausteine allesamt sehr mit Vorsicht zu genie√üen.</p>
<p>Das folgende Coding f√ºgt einem Fertigungsauftrag eine Komponente (Materialnummer) hinzu.</p>
<h2>Code</h2>
<pre class="">"Lokale Daten
DATA ls_return TYPE coxt_bapireturn.
DATA lt_return TYPE coxt_t_bapireturn.
DATA lv_error_occurred TYPE boolean.
DATA ls_resbd_created TYPE resbd.
DATA lt_resbt_exp TYPE STANDARD TABLE OF resbb.
DATA lv_posnr TYPE positionno.

DATA ls_quan TYPE coxt_s_quantity.
DATA ls_stor_loc TYPE coxt_s_storage_location.
DATA ls_stor_loc_x TYPE coxt_s_storage_locationx.

ls_quan-quantity    = menge.
ls_quan-uom         = meins.

ls_stor_loc-werks   = werks.
ls_stor_loc-lgort   = lgort.
ls_stor_loc_x-werks = abap_true.
ls_stor_loc_x-lgort = abap_true.

"Komponente hinzuf√ºgen
CALL FUNCTION 'CO_XT_COMPONENT_ADD'
  EXPORTING
    is_order_key         = aufnr
    i_material           = matnr
    is_requ_quan         = ls_quan
    i_operation          = 1
    is_storage_location  = ls_stor_loc
    is_storage_locationx = ls_stor_loc_x
    i_postp              = 'L' "Lagerposition
    i_posno              = lv_posnr
  IMPORTING
    es_bapireturn        = ls_return
    e_error_occurred     = lv_error_occurred
    es_resbd_created     = ls_resbd_created
  TABLES
    resbt_exp            = lt_resbt_exp.

IF lv_error_occurred = abap_false.
*== PRE-Commit
  CALL FUNCTION 'CO_XT_ORDER_PREPARE_COMMIT'
    TABLES
      et_bapireturn = lt_return.

"Keine Fehler!
  CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'.
ELSE.
"Fehlerbehandlung
ENDIF.</pre>
<h2>Fehlende Positionsnummer</h2>
<p><a href="https://tricktresor.com/wp-content/uploads/2017/04/2017-04-01_01-41-27.jpg"><img loading="lazy" decoding="async" class="size-full wp-image-1017967 alignnone" src="https://tricktresor.com/wp-content/uploads/2017/04/2017-04-01_01-41-27.jpg" alt="" width="455" height="140" srcset="/wp-content/uploads/2017/04/2017-04-01_01-41-27.jpg 455w, /wp-content/uploads/2017/04/2017-04-01_01-41-27-300x92.jpg 300w" sizes="(max-width: 455px) 100vw, 455px" /></a></p>
<p>Der Baustein hat leider einen kleinen Sch√∂nheitsfehler: Die Positionsnummer (RSB-POSNR) wird leider nicht gesetzt und kann auch nicht ohne weiteres ge√§ndert werden. Um die Positionsnummer trotzdem √§ndern zu k√∂nnen, habe ich zwei L√∂sungen gefunden:</p>
<ol>
<li>Die √Ñnderung der internen Tabelle RESB_BT ¬†√ºber einen Dirty-Assign</li>
<li>√Ñnderung √ºber die Standardbausteine
<ul>
<li>CO_BT_RESB_READ_WITH_KEY</li>
<li>CO_BT_RESB_GET_LAST_POSNR</li>
<li>CO_BT_RESB_UPDATE</li>
</ul>
</li>
</ol>
<p>Die √Ñnderung muss nach dem CO_XT_COMPONENT_ADD und vor dem Commit erfolgen.</p>
<h3>Positionsnummer √§ndern √ºber Dirty-Assign</h3>
<pre class="">*--------------------------------------------------------------------*
* set item number
*--------------------------------------------------------------------*
  TYPES: BEGIN OF ts_resb_bt.
    INCLUDE TYPE resbb.
    TYPES: indold LIKE sy-tabix,
    no_req_upd LIKE sy-datar,
  END OF ts_resb_bt.

  TYPES tt_resb_bt TYPE TABLE OF ts_resb_bt.
  FIELD-SYMBOLS &lt;lt_resb_bt&gt; TYPE tt_resb_bt.
  FIELD-SYMBOLS &lt;ls_resb_bt&gt; TYPE ts_resb_bt.

  ASSIGN ('(SAPLCOBC)RESB_BT[]') TO &lt;lt_resb_bt&gt;.
  LOOP AT &lt;lt_resb_bt&gt; ASSIGNING &lt;ls_resb_bt&gt;.
    IF &lt;ls_resb_bt&gt;-posnr IS INITIAL.
      &lt;ls_resb_bt&gt;-posnr = CONV numc04( &lt;ls_resb_bt&gt;-rspos * 10 ).
    ENDIF.
  ENDLOOP.
</pre>
<h3>√Ñnderung der Positionsnummer √ºber Funktionsbausteine</h3>
<pre class=""> DATA resbd_exp TYPE resbd.
 DATA posnr_max TYPE tcn41-posnr_mat.
 DATA index_exp TYPE sy-tabix.
 DATA vbkz_exp  TYPE resbb-vbkz.
 DATA nfgrp_exp TYPE resbd-nfgrp.
 DATA posnr_exp TYPE resbd-posnr.

 CALL FUNCTION 'CO_BT_RESB_READ_WITH_KEY'
   EXPORTING
     rsart_imp = ls_resbd-rsart
     rsnum_imp = ls_resbd-rsnum
     rspos_imp = ls_resbd-rspos
   IMPORTING
     index_exp = index_exp " Index interner Tabellen
     posnr_exp = posnr_exp " Nummer der St√ºcklistenposition
     resbd_exp = resbd_exp " Reservierung/Sekund√§rbedarf
     nfgrp_exp = nfgrp_exp " Ein-/Auslaufdaten: Nachfolgegruppe
     vbkz_exp  = vbkz_exp " Verbuchungskennzeichen
   EXCEPTIONS
     not_found = 1
     OTHERS    = 2.

 CALL FUNCTION 'CO_BT_RESB_GET_LAST_POSNR'
   EXPORTING
     aufpl     = aufpl
     aplzl     = aplzl
   IMPORTING
     posnr_max = posnr_max. 

 resbd_exp-posnr = posnr_max + 10.

 CALL FUNCTION 'CO_BT_RESB_UPDATE'
   EXPORTING
     resb_new  = resbd_exp
     tabix_old = index_exp.</pre>
<h2>Dialog oder nicht Dialog?</h2>
<p>Ein weiteres Problem k√∂nnte der Baustein¬†CO_XT_ORDER_PREPARE_COMMIT machen, denn bei der √Ñnderung des Fertigungsauftrags k√∂nnen Popups erscheinen, die vom Anwender best√§tigt werden m√ºssen.</p>
<p>Wenn man Dialoge verhindern m√∂chte, dann muss der Update-Baustein CO_ZV_ORDER_POST direkt aufgerufen werden. Dieser hat einen Parameter NO_DIALOG, den man entsprechend mit X besetzen kann.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Der Beitrag <a href="/blog/komponenten-einem-fertigungsauftrag-hinzufuegen/">Komponenten einem Fertigungsauftrag hinzuf√ºgen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>Preisfindung im Kundenauftrag von au√üen anstossen</title>
		<link>/blog/preisfindung-im-kundenauftrag-von-aussen-anstossen/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Wed, 29 Mar 2017 20:25:15 +0000</pubDate>
				<category><![CDATA[ABAP 740]]></category>
		<category><![CDATA[Vertrieb]]></category>
		<category><![CDATA[Programmierung]]></category>
		<category><![CDATA[BAPI]]></category>
		<category><![CDATA[BAPI_SALESORDER_CHANGE]]></category>
		<category><![CDATA[Vertriebsbeleg]]></category>
		<category><![CDATA[Preisfindung]]></category>
		<category><![CDATA[SAPMV45A]]></category>
		<guid isPermaLink="false">https://tricktresor.com/?p=1017958</guid>

					<description><![CDATA[<p>In diesem Beitrag zeige ich dir, wie du die Preisfindung eines Kundenauftrags neu ausf√ºhren lassen kannst. Das grunds√§tzliche Verfahren sieht so aus: Userexit in SAPMV45A anpassen Parameter setzen BAPI aufrufen Parameter zur√ºcknehmen Um die Preisfindung von au√üen triggern zu k√∂nnen, musst du √Ñnderungen im Programm SAPMV45A durchf√ºhren. Zuerst ben√∂tigst du jedoch die M√∂glichkeit, einen Parameter zur Laufzeit zu setzen, der dann im SAPMV45A abgefragt werden kann. Das kann gut √ºber eine der beiden Methoden erfolgen:...</p>
<p>Der Beitrag <a href="/blog/preisfindung-im-kundenauftrag-von-aussen-anstossen/">Preisfindung im Kundenauftrag von au√üen anstossen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>In diesem Beitrag zeige ich dir, wie du die Preisfindung eines Kundenauftrags neu ausf√ºhren lassen kannst. Das grunds√§tzliche Verfahren sieht so aus:</p>
<ol>
<li>Userexit in SAPMV45A anpassen</li>
<li>Parameter setzen</li>
<li>BAPI aufrufen</li>
<li>Parameter zur√ºcknehmen</li>
</ol>
<p>Um die Preisfindung von au√üen triggern zu k√∂nnen, musst du √Ñnderungen im Programm SAPMV45A durchf√ºhren. Zuerst ben√∂tigst du jedoch die M√∂glichkeit, einen Parameter zur Laufzeit zu setzen, der dann im SAPMV45A abgefragt werden kann. Das kann gut √ºber eine der beiden Methoden erfolgen:</p>
<ol>
<li>EXPORT TO MEMORY und IMPORT FROM MEMORY</li>
<li>√ñffentliches Attribut der eigenen globalen Klasse</li>
</ol>
<h2>Anlage der globalen Klasse</h2>
<p>Als erstes musst du eine Klasse anlegen mit der die neue Preisfindung durchgef√ºhrt werden soll. In meinem Beispiel hei√üt sie ZCL_SD_NP (New Pricing).</p>
<p>Lege das √∂ffentliche Klassenattribut KNPRS vom Typ KNPRS an (static). Das ist die Preisfindungsart, mit der die Art der neuen Preisfindung gesteuert werden kann.</p>
<h2>Quelltext (relevanter Teil ) in MV45AFZB:</h2>
<pre class="">FORM¬†userexit_new_pricing_vbap¬†CHANGING¬†new_pricing.
¬† IF¬†zcl_sd_np=&gt;knprs¬†IS¬†NOT¬†INITIAL. ¬†
 ¬†¬†¬†¬†new_pricing¬†=¬†zcl_sd_np=&gt;knprs.
 ¬†¬†ENDIF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"USEREXIT_NEW_PRICING_VBAP</pre>
<pre class="">FORM¬†userexit_new_pricing_vbkd¬†CHANGING¬†new_pricing.
¬† IF¬†zcl_sd_np=&gt;knprs¬†IS¬†NOT¬†INITIAL.¬†
 ¬†¬†¬†¬†new_pricing¬†=¬†zcl_sd_np=&gt;knprs.
 ¬†¬†ENDIF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"USEREXIT_NEW_PRICING_VBKD</pre>
<h2>Quelltext Klasse</h2>
<p>Nun brauchen wir noch die Methode TRIGGER_NEW_PRICING</p>
<p><a href="https://tricktresor.com/wp-content/uploads/2017/03/zcl_sd_np-e1490818768143.png"><img loading="lazy" decoding="async" class="size-full wp-image-1017959 alignnone" src="https://tricktresor.com/wp-content/uploads/2017/03/zcl_sd_np-e1490818768143.png" alt="" width="776" height="177" srcset="/wp-content/uploads/2017/03/zcl_sd_np-e1490818768143.png 776w, /wp-content/uploads/2017/03/zcl_sd_np-e1490818768143-300x68.png 300w, /wp-content/uploads/2017/03/zcl_sd_np-e1490818768143-768x175.png 768w" sizes="(max-width: 776px) 100vw, 776px" /></a></p>
<pre class="">DATA:¬†
  ls_bapisdh1x¬†¬†TYPE¬†bapisdh1x,
  lt_pos¬†¬†¬†¬†¬†¬†¬†¬†TYPE¬†STANDARD¬†TABLE¬†OF¬†bapisditm¬†WITH¬†NON-UNIQUE¬†DEFAULT¬†KEY,
  lt_posx¬†¬†¬†¬†¬†¬†¬†TYPE¬†STANDARD¬†TABLE¬†OF¬†bapisditmx¬†WITH¬†NON-UNIQUE¬†DEFAULT¬†KEY,
  lt_return¬†¬†¬†¬†¬†TYPE¬†bapiret2_t.
FIELD-SYMBOLS:¬†
  &lt;ls_pos&gt;¬†    ¬†LIKE¬†LINE¬†OF¬†lt_pos,
  &lt;ls_posx&gt;¬†    LIKE¬†LINE¬†OF¬†lt_posx.


CLEAR¬†ct_bapiret2.
knprs¬†=¬†iv_knprs.
*--------------------------------------------------------------------*
*¬†Get¬†all¬†positions¬†to¬†be¬†redermined
*--------------------------------------------------------------------*
SELECT¬†posnr¬†AS¬†itm_number¬†werks¬†AS¬†plant
INTO¬†CORRESPONDING¬†FIELDS¬†OF¬†TABLE¬†lt_pos
FROM¬†vbap
WHERE¬†vbeln¬†=¬†iv_vbeln_va.

LOOP¬†AT¬†lt_pos¬†ASSIGNING¬†&lt;ls_pos&gt;.
APPEND¬†INITIAL¬†LINE¬†TO¬†lt_posx¬†ASSIGNING¬†&lt;ls_posx&gt;.
&lt;ls_posx&gt;-itm_number¬†=¬†&lt;ls_pos&gt;-itm_number.
&lt;ls_posx&gt;-updateflag¬†=¬†'U'.
ENDLOOP.

ls_bapisdh1x-updateflag¬†=¬†'U'.
CALL¬†FUNCTION¬†'BAPI_SALESORDER_CHANGE'
  EXPORTING
    salesdocument¬†¬†¬†¬†=¬†iv_vbeln_va
    order_header_inx¬†=¬†ls_bapisdh1x
  TABLES
    return¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†=¬†ct_bapiret2
    order_item_in¬†¬†¬†¬†=¬†lt_pos
    order_item_inx¬†¬†¬†=¬†lt_posx
  EXCEPTIONS
    ERROR_MESSAGE¬†=¬†1.

CLEAR¬†knprs.¬†¬†"¬†Only¬†once

TRY.
    DATA(ls_return) =¬†ct_bapiret2[ type¬†=¬†'E' ].
    CALL¬†FUNCTION¬†'BAPI_TRANSACTION_ROLLBACK'.
    RAISE¬†EXCEPTION¬†TYPE¬†zcx_my_exception.
  CATCH CX_SY_ITAB_LINE_NOT_FOUND.
    CALL¬†FUNCTION¬†'BAPI_TRANSACTION_COMMIT'.
ENDTRY.
</pre>
<p>Durch Aufruf der Methode ZCL_SD_NP=&gt;TRIGGER_NEW_PRICING( &#8230; ) kannst du nun einen Beleg dazu bewegen, eine neue Preisfindung durchzuf√ºhren.</p>
<p>Der Beitrag <a href="/blog/preisfindung-im-kundenauftrag-von-aussen-anstossen/">Preisfindung im Kundenauftrag von au√üen anstossen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
		<item>
		<title>Selektion f√ºr MD04/ MD06 + MS04/06 eingrenzen</title>
		<link>/blog/selektion-fuer-md04-md06-ms0406-eingrenzen/</link>
		
		<dc:creator><![CDATA[Enno Wulff]]></dc:creator>
		<pubDate>Fri, 29 Jul 2016 15:47:54 +0000</pubDate>
				<category><![CDATA[Info/ Doku/ Demo]]></category>
		<category><![CDATA[Materialwirtschaft]]></category>
		<category><![CDATA[BAdI]]></category>
		<category><![CDATA[MD04]]></category>
		<category><![CDATA[md06]]></category>
		<guid isPermaLink="false">https://tricktresor.com/?p=750280</guid>

					<description><![CDATA[<p>Je nach Gr√∂√üe und aufkommen in Werk und Dispobereich dauert die Auswertung in den Transaktionen recht lange. Die Standardselektion erlaubt es leider nur sehr begrenzt die Ergebnismenge einzugrenzen ‚Äì Select-Options vermisst man g√§nzlich. Dies l√§sst sich jedoch anpassen...</p>
<p>Der Beitrag <a href="/blog/selektion-fuer-md04-md06-ms0406-eingrenzen/">Selektion f√ºr MD04/ MD06 + MS04/06 eingrenzen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>Je nach Gr√∂√üe und aufkommen in Werk und Dispobereich dauert die Auswertung in den Transaktionen recht lange. Die Standardselektion erlaubt es leider nur sehr begrenzt die Ergebnismenge einzugrenzen ‚Äì Select-Options vermisst man g√§nzlich. Der Benutzer wird oft gezwungen die komplette Liste aufzubauen und anschlie√üend mit Filtern die Datenmenge einzugrenzen.<br />
Zum Gl√ºck bietet die SAP uns hier die M√∂glichkeit die Situation mittels BAdI MD_EXCLUDE_MATERIAL zu verbessern. Der BAdI erlaubt es im Einstiegsbild einen zus√§tzlichen Reiter ‚ÄûZusatzselektion‚Äú einzubinden und dort ein eigenes Dynpro mit einem Selektionsbild einzubinden.</p>
<h2>Link zur SAP-Doku</h2>
<p>https://help.sap.com/erp_hcm_ias_2013_01/helpdata/de/45/188147e1235d79e10000000a11466f/content.htm</p>
<blockquote><p>‚ÄûSAP empfiehlt, sich stark an der Beispielimplementierung zu orientieren und einen speziellen kundenspezifischen Report analog dem Report RMD07_BADI_SCREEN_EXTENSION01 mit Selektionsscreen 347 und Auswahl-Formroutine zu definieren. Der Selektions-Subscreen muss dann in der Screen-Erweiterung den leeren Subscreen 347 ersetzen, w√§hrend die Auswahl-Formroutine innerhalb der Methode EXCLUDE_MATERIAL_EVAL aufgerufen werden muss.‚Äú</p></blockquote>
<h2>Demoreport der SAP</h2>
<p>Report RMD07_BADI_SCREEN_EXTENSION01</p>
<h2>Beispiel</h2>
<p>Beispielsweise k√∂nnte das wie folgt aussehen:</p>
<p><figure id="attachment_750281" aria-describedby="caption-attachment-750281" style="width: 547px" class="wp-caption alignnone"><a href="https://tricktresor.com/wp-content/uploads/2016/07/2016-07-29_17-35-45.jpg"><img loading="lazy" decoding="async" class="size-full wp-image-750281" src="https://tricktresor.com/wp-content/uploads/2016/07/2016-07-29_17-35-45.jpg" alt="Erweiterung der Selektionsoptionen bei MD04" width="547" height="444" srcset="/wp-content/uploads/2016/07/2016-07-29_17-35-45.jpg 547w, /wp-content/uploads/2016/07/2016-07-29_17-35-45-300x244.jpg 300w" sizes="(max-width: 547px) 100vw, 547px" /></a><figcaption id="caption-attachment-750281" class="wp-caption-text">Erweiterung der Selektionsoptionen bei MD04</figcaption></figure></p>
<p>Vor der Auswertung der Dispositionsdaten wird dann f√ºr jedes Material im Dispobereich die BAdI-Methode gerufen und die M√∂glichkeit gegeben das Material aus der Auswertung auszuschlie√üen.<br />
Unbefriediegend dabei ist, dass die ‚ÄûSpeichern‚Äú Funktion des Standards die Eingabewert im Subscreen nicht mit speichert und entsprechend beim Start der Transaktion nicht wiederherstellt. Zum Gl√ºck erlaubt uns das Sel-Screen Eventing die entsprechenden Zeitpunkte ebenfalls abzuhandeln und das so zu erm√∂glichen. *** Einmalig beim Start der Transaktion gespeicherte Daten wiederherstellen via FuBa RS_SUPPORT_SELECTIONS</p>
<pre>CASE sy-ucomm. 
  WHEN 'YES'. 
*** Wiederherstellen Selektionsbild via FuBa RS_SUPPORT_SELECTIONS wenn 
*** der Benutzer zur√ºck aus der Auswertung kommt. 
  WHEN 'SAVP'. 
*** Speichern des Selektionsbild via FuBa RS_REFRESH_FROM_SELECTOPTIONS 
*** und RS_CHANGE_CREATED_VARIANT_255 bzw. RS_CREATE_VARIANT_255 
ENDCASE.</pre>
<p>Der Beitrag <a href="/blog/selektion-fuer-md04-md06-ms0406-eingrenzen/">Selektion f√ºr MD04/ MD06 + MS04/06 eingrenzen</a> erschien zuerst auf <a href="/">Tricktresor</a>.</p>
]]></content:encoded>
					
		
		
			</item>
	</channel>
</rss>
